<style type="text/css">

.custom-mscom-flipswitch.ui-flipswitch.ui-bar-inherit {
	background-color: #EEEEEE !important;
	color:black !important;
	text-shadow: none !important;
}

.custom-mscom-flipswitch.ui-flipswitch .ui-btn.ui-flipswitch-on {
	background-color: #6dac20 !important;
	color:black !important;
	text-indent: -3.5em !important;
	text-shadow: none !important;
}

</style>

<TMPL_IF SETTINGS>
    <!-- form 'FORM' START -->
	
    <form method="post" data-ajax="false" accept-charset="utf-8" name="main_form" id="main_form" action="./index.cgi?form">
        <input type="hidden" name="saveformdata1" value="1">
		<input type="hidden" name="regionOptions" id="regionOptions" value="<TMPL_VAR TTS.regionms>">
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/table.css"/>
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.min.css"/>
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.css"/>
		<script src="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.min.js"></script>
		<script src="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.js"></script>
	
        <div class="form-group">
            <font COLOR="blue">
                <TMPL_VAR SAVE>
            </font>

            <table class="formtable" border="0" width="100%" cellpadding="10">
                <tr>
				
				<TMPL_IF NAME="PLAYERAVAILABLE">
                    <td valign="middle" style="height: 33px; width: 25%; text-align: center; color:black">
				<TMPL_ELSE>
					<td valign="middle" style="height: 33px; width: 25%; text-align: center; color:red">
				</TMPL_IF>
                        <h2 class="auto-style3" style="width: 100%">
                            <TMPL_VAR ZONES.SONOS_CONFIG>
                        </h2>
                        <td style="height: 33px; text-align: center;">
                            <img class='ico_sonos' src='/plugins/<TMPL_VAR PLUGINDIR>/images/sonos_logo.png' border='0' width='186' height='125' align="absmiddle">
                        </td>
                        <td style="height: 33px; width: 80px;"></td>

                </tr>
                <tr>
                    <td style="height: 41px; width: 25%;" valign="top">
                        <label id="lzonen"><TMPL_VAR ZONES.SONOS_ZONE_LABEL></label>
                    </td>
                    <td valign="middle" style="height: 41px; width: 60%;">
						<table class="tables" width="85%" id="tblzonen" name="tblzonen">
                            <tr>
								<th align="middle"><img class='ico_delete' src='/plugins/<TMPL_VAR PLUGINDIR>/images/recycle-bin.png' border='0' width='24' height='24'></th>
                                <th align="left">
                                    <TMPL_VAR ZONES.SONOS_ROOM>
                                </th>
								<th align="left" style="height: 45px; width: 8px">
                                    <TMPL_VAR ZONES.SONOS_MAIN>
                                </th>
                                <th align="left">
                                    <TMPL_VAR ZONES.SONOS_MODEL>
                                </th>
								<th align="middle" style="height: 25px; width:10px">
                                    <TMPL_VAR ZONES.SONOS_MODEL.PIC>
                                </th>
                                <th align="left">
                                    <TMPL_VAR ZONES.SONOS_IP>
                                </th>
								<th align="middle">
                                    <TMPL_VAR ZONES.SONOS_AUDIOCLIP>
                                </th>
                                <th align="left">
                                    <TMPL_VAR ZONES.SONOS_T2S-VOL>
                                </th>
                                <th align="left">
                                    <TMPL_VAR ZONES.SONOS_SONOS-VOL>
                                </th>
                                <th align="left">
                                    <TMPL_VAR ZONES.SONOS_MAX-VOL>
                                </th>
                            </tr>
                            <TMPL_VAR ROWSSONOSPLAYER>
                        </table>
						<TMPL_IF NAME="PLAYERAVAILABLE">
							<div class='icoclip' style='text-align: left;'>
								&nbsp;&nbsp;&nbsp;<img class='icoclip' src='/plugins/<TMPL_VAR PLUGINDIR>/images/green.png' border='0' width='26' height='28' align="absmiddle"><TMPL_VAR ZONES.SONOS_AUDIOCLIP_GREEN>
								<img class='icoclip' src='/plugins/<TMPL_VAR PLUGINDIR>/images/yellow.png' border='0' width='26' height='28' align="absmiddle"><TMPL_VAR ZONES.SONOS_AUDIOCLIP_YELLOW>
								<img class='icoclip' src='/plugins/<TMPL_VAR PLUGINDIR>/images/red.png' border='0' width='26' height='28' align="absmiddle"><TMPL_VAR ZONES.SONOS_AUDIOCLIP_RED>
							</div>
						</TMPL_IF>
                    </td>
                    <td style="height: 41px;" valign="top">
                        <a onClick="discover()" id="btnplayerscan" data-role="button" data-inline="true" data-mini="true" data-icon="check" href="#">
                            <TMPL_VAR T2S.BUTTON_SCAN>
                        </a>
                    </td>
                </tr>
				
				
	            <tr>			
					<td style="height: 60px; width: 15%;">
						<label id="lt2son"><TMPL_VAR T2S.LABEL_T2SON></label>
					</td>
					<td style="height: 60px; width: 20%;">
						<table border=0 width="10%">
								<td style="width: 5%">
									<fieldset>
										<select id="t2son" name="t2son" data-role="flipswitch" style="width: 5%">
											<option value="false"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
											<option selected="selected" value="true"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
										</select>
									</fieldset>
									<script>
										$('#t2son').val('<TMPL_VAR TTS.t2son>')
									</script>
								</td>
						</table>
					</td>		
				</tr>
				
				<tr class="tvmon_switch">
					<td class="tvmon_switch" style="height: 60px; width: 25%;">
                        <label align="left" id="lfunc_list"><TMPL_VAR ZONES.SONOS_LABEL_TV-VOL></label>
                    </td>
                    <td class="tvmon_switch" width="5%" style="height: 60px">
                        <table border=0 width="100%">
                            <tr>
                                <td style="width: 6%">
                                    <fieldset>
										<select onchange="validateTVMon()" id="tvmon" name="tvmon" data-role="flipswitch" style="width: 5%">
											<option selected="selected" value="false"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
											<option value="true"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
										</select>
                                    </fieldset>
									<script>
										$('#tvmon').val('<TMPL_VAR VARIOUS.tvmon>');
									</script>	
                                </td>
                                <td class="tvmon_header" style="width: 23px; text-align: center;">
                                    &nbsp;</td>
                                <td>
                                    <table border=0 style="width: 100%">
                                        <tr>
                                            <td class="tvmon_header" style="height: 60px; width: 12%">
												<label align="right" id="lstart"><TMPL_VAR ZONES.SONOS_LABEL_START></label>
											</td>
                                <td class="tvmon_header" style="width: 10%">
									<div id="tvmon_addstart">
										<fieldset style="width: 95%">
										<select id="starttime" name="starttime" data-mini="true" data-native-menu="true" style="width: 100%">
											  <option value="0">0:00</option>
											  <option value="1">1:00</option>
											  <option value="2">2:00</option>
											  <option value="3">3:00</option>
											  <option value="4">4:00</option>
											  <option value="5">5:00</option>
											  <option value="6">6:00</option>
											  <option value="7">7:00</option>
											  <option value="8">8:00</option>
											  <option value="9">9:00</option>
											  <option value="10">10:00</option>
											  <option value="11">11:00</option>
											  <option value="12">12:00</option>
											  <option value="13">13:00</option>
											  <option value="14">14:00</option>
											  <option value="15">15:00</option>
											  <option value="16">16:00</option>
											  <option value="17">17:00</option>
											  <option value="18">18:00</option>
											  <option value="19">19:00</option>
											  <option value="20">20:00</option>
											  <option value="21">21:00</option>
											  <option selected="selected" value="22">22:00</option>
											  <option value="23">23:00</option>
										</select>
									</fieldset>
                                    <script>
                                        $('#starttime').val('<TMPL_VAR VARIOUS.starttime>');
                                    </script>
									</div>
                                </td>
								<td class="tvmon_header" style="width: 3%; height: 60px;">
                                    <label align="right" id="lend"><TMPL_VAR ZONES.SONOS_LABEL_END></label>
                                </td>
                                <td class="tvmon_header" style="width: 50%">
									<div id="tvmon_addend">
										<fieldset style="width: 20%">
											<select id="endtime" name="endtime" data-mini="true" data-native-menu="true" style="width: 100%">
												  <option value="0">0:00</option>
												  <option value="1">1:00</option>
												  <option value="2">2:00</option>
												  <option value="3">3:00</option>
												  <option value="4">4:00</option>
												  <option value="5">5:00</option>
												  <option value="6">6:00</option>
												  <option value="7">7:00</option>
												  <option value="8">8:00</option>
												  <option value="9">9:00</option>
												  <option value="10">10:00</option>
												  <option value="11">11:00</option>
												  <option value="12">12:00</option>
												  <option value="13">13:00</option>
												  <option value="14">14:00</option>
												  <option value="15">15:00</option>
												  <option value="16">16:00</option>
												  <option value="17">17:00</option>
												  <option value="18">18:00</option>
												  <option value="19">19:00</option>
												  <option value="20">20:00</option>
												  <option value="21">21:00</option>
												  <option selected="selected" value="22">22:00</option>
												  <option value="23">23:00</option>
											</select>
										</fieldset>
										<script>
											$('#endtime').val('<TMPL_VAR VARIOUS.endtime>');
										</script>
									</div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </td>
        
		</tr>
				<tr class="tvmon_header">
					<td style="width: 15%; height: 20px;" valign="top">
						</td>
					<div class="soundbars">
						<td valign="middle" style="height: 15px; width: 90%;">
							<table class="tables" width="100%" id="tblsb" name="tblsb">
								<tr>
									<th align="middle"><TMPL_VAR SOUNDBARS.LABEL_USE></th>
									<th align="left"><TMPL_VAR SOUNDBARS.LABEL_SOUNDBAR></th>
									<th align="middle"><TMPL_VAR SOUNDBARS.LABEL_SPEECH></th>
									<th align="middle"><TMPL_VAR SOUNDBARS.LABEL_SURROUND></th>
									<th align="middle"><TMPL_VAR SOUNDBARS.LABEL_SUB></th>
									<th align="middle" id="tvmtvol" name="tvmtvol"><TMPL_VAR SOUNDBARS.LABEL_TVVOL></th>
									<th align="middle"><TMPL_VAR SOUNDBARS.LABEL_FROM_TIME></th>
									<th align="middle"><TMPL_VAR SOUNDBARS.LABEL_NIGHT></th>
									<th align="middle"><TMPL_VAR SOUNDBARS.LABEL_SUB_GAIN></th>
									
								</tr>
								<TMPL_VAR ROWSOUNDBARS>
							</table>
						</td>
					</div>
				</tr>
				<tr>
					<td style="width: 201px; height: 20px;" valign="top">
                    </td>
                    <td id="info" name="info" style="width: 201px; height: 20px;" valign="top">
                        <font color=#FF0000>
                            <marquee>
                                <TMPL_VAR INFO>
                            </marquee>
                        </font>
                    </td>
				</tr>
				
                <tr>
                    <td style="width: 20%; height: 45px;">
                        <label id="ltts_instanz"><TMPL_VAR T2S.TTS_INSTANZ></label>
                    </td>
                    <td style="width: 55%; height: 45px;">
                        <fieldset id="engine-selector" data-role="controlgroup" data-type="horizontal">
                            <input type="radio" name="t2s_engine" id="tts_voicerss" value="1001">
                            <TMPL_VAR SELECTEDINSTANZ2>
                                <label for="tts_voicerss">VoiceRSS</label>

                                <input type="radio" name="t2s_engine" id="tts_mac_osx" value="3001">
                                <TMPL_VAR SELECTEDINSTANZ3>
                                    <label for="tts_mac_osx">OSX</label>

                                    <input type="radio" name="t2s_engine" id="tts_polly" value="4001">
                                    <TMPL_VAR SELECTEDINSTANZ4>
                                        <label for="tts_polly">AWS Polly</label>

                                        <input type="radio" name="t2s_engine" id="tts_pico" value="5001">
                                        <TMPL_VAR SELECTEDINSTANZ5>
                                            <label for="tts_pico">Pico2Wave</label>

                                            <input type="radio" name="t2s_engine" id="tts_respvoice" value="6001">
                                            <TMPL_VAR SELECTEDINSTANZ6>
                                                <label for="tts_respvoice">RespVoice</label>

                                                <input type="radio" name="t2s_engine" id="tts_google_cloud" value="8001">
                                                <TMPL_VAR SELECTEDINSTANZ8>
                                                    <label for="tts_google_cloud">Google Cloud</label>
													
													<input type="radio" name="t2s_engine" id="tts_azure" value="9001">
													<TMPL_VAR SELECTEDINSTANZ9>
														<label for="tts_azure">MS Azure</label>

														<input type="radio" name="t2s_engine" id="tts_google" value="7001">
														<TMPL_VAR SELECTEDINSTANZ7>
															<label for="tts_google">Google</label>
															
																<input type="radio" name="t2s_engine" id="tts_elevenlabs" value="9011">
																<TMPL_VAR SELECTEDINSTANZ10>
																	<label for="tts_elevenlabs">ElevenLabs</label>
														
															

                        </fieldset>
			<script>
				$('#engine-selector input').change(function() {
					var t2sengine = $('input[name=t2s_engine]:checked').val();
					$.ajax({url: "./index.cgi?getkeys=1&t2s_engine="+t2sengine, type: 'GET', dataType: 'json', success: function(result){
						$("#apikey").val(result.apikey);
						$("#seckey").val(result.seckey);
					}});
				});
			</script>
                        <div class="ttsconfig googleinfo 7001">
                            <label align="middle"><FONT size="-1" COLOR="#0000CD"><TMPL_VAR T2S.GOOGLE_INFO></FONT></label>
                        </div>
                        <div class="ttsconfig googlecloudinfo 8001">
                            <label align="middle"><FONT size="-1" COLOR="#0000CD"><TMPL_VAR T2S.GOOGLE_CLOUD_INFO></FONT></label><br>
                            <font size="-1" align="middle">
                                <a id="linkgoogleapi" href="https://www.youtube.com/watch?v=1n8xlVNWEZ0" target="_blank">
                                    <TMPL_VAR T2S.GOOGLE_CLOUD_API_LINK>
                                </a>
                            </font>
                        </div>
						
						<div class="ttsconfig elevenlabsinfo 9011">
                             <font size="-1" align="middle">
                                <a id="linkazureapi" href="https://elevenlabs.io/" target="_blank">
                                    <TMPL_VAR T2S.ELEVENLABS_API_LINK>
                                </a>
                            </font>
                        </div>
						
						
						
						<div class="ttsconfig azureinfo 9001">
                             <font size="-1" align="middle">
                                <a id="linkazureapi" href="/plugins/<TMPL_VAR PLUGINDIR>/voice_engines/bin/Azure_Account.pdf" target="_blank">
                                    <TMPL_VAR T2S.AZURE_API_LINK>
                                </a>
                            </font>
                        </div>

                    </td>
                    <td valign="middle" style="height: 45px; width: 201px;" class="ttsconfig 1001 4001 keylinks">
                        <font size="-1">
                            <a class="ttsconfig 1001" id="linkvoicerss" target="_blank">
                                <TMPL_VAR T2S.LABEL_API_KEY_VOICESS>
                            </a>
                        </font>
                        <br><br>
                        <font size="-1">
                            <a class="ttsconfig 4001" id="linkpolly" target="_blank">
                                <TMPL_VAR T2S.LABEL_API_KEY_POLLY>
                            </a>
                        </font>
                        <font size="-1"><span><TMPL_VAR T2S.LABEL_CLOUDSERVICE_PRICING></span></font>
                    </td>
                    
                </tr>

                <tr class="ttsconfig colapi 1001 4001 8001 9001 9011">
                    <td style="height: 48px; width: 25%">
                        <label id="lapikey"><TMPL_VAR T2S.LABEL_API_KEY></label>
                    </td>
                    <td style="width: 50%; height: 48px">
                        <input id="apikey" name="apikey" type="text" class="textfield" value="<TMPL_VAR APIKEY>">
					</td>
                    <td style="height: 48px; width: 100px;" class="auto-style4" valign="top">
                        <div class="ttsconfig btnpopulategooglevoices 8001 9001 9011">
                            <a onClick="checkProvider()" data-role="button" data-inline="true" data-mini="true" href="#">
                                <TMPL_VAR T2S.BUTTON_VOICES>
                            </a>
                        </div>
                    
                </tr>
                <tr class="ttsconfig colsec 4001">
                    <td style="width: 25%; height: 48px;">
                        <label id="lseckey"><TMPL_VAR T2S.LABEL_SECRET_KEY></label>
                    </td>
                    <td style="width: 50%; height: 48px;">
                        <input id="seckey" name="seckey" type="text" class="textfield" value="<TMPL_VAR SECKEY>">

                        <td style="width: 201px; height: 48px;">
                        </td>
                        
                </tr>
				<p id="errorinfo"></p>
                <tr class="ttsconfig ttsbaseconfig collang">
                    <td style="height: 60px; width: 25%;">
                        <label id="llang"><TMPL_VAR T2S.TTS_LANGUAGE></label>
                    </td>
                    <td width="50%" style="height: 60px">
                        <table border=0 width="100%">
                            <tr>
                                <div data-role="collapsible">
                                    <td style="height: 36px; width:25%; text-align: left;">
                                        <fieldset style="width: 100%">
                                            <select id="t2slang" name="t2slang" data-mini="true";" 
												data-validation-error-msg="<TMPL_VAR T2S.SELECT_LANGUAGE_DROPDOWN>" 
												data-validation-rule="^([A-Za-z0-9]){4,10}$">
											</select>
                                        </fieldset>
                                    </td>
                                    <div id="loginResult" style="display:none;">
                                    </div>
                                    <div id="msg"></div>
                                    <td style="height: 36px; width: 35%;" class="ttsconfig field-voice 4001 8001 9011" style="display:none">
                                        <fieldset style="width: 100%">
                                            <select class="voice_select" id="voice" name="voice" data-mini="true";"
											data-validation-error-msg="<TMPL_VAR T2S.SELECT_VOICE_DROPDOWN>" 
											data-validation-rule="^([A-Za-z0-9]){4,10}$">
										</select>
								<div class="ttsconfig field-voice 9011">
									<td class="ttsconfig field-voice 9011" style="height: 36px; width: 8%; text-align: left;">
										<img onclick="playprev()" src='/plugins/<TMPL_VAR PLUGINDIR>/images/play-button.png'>
									</td>
								</div>
                                        </fieldset>
                                        <td style="height: 36px; width: 32%; text-align: right;">
                                            <fieldset style="width: 15%">
                                                <input name="langiso" id="langiso" readonly="true" type="text" align="middle">
                                            </fieldset>
                                        </td>
                                </div>
                            </tr>
                        </table>
                        </td>
                        <td style="height: 30px; width: 201px;">
                        </td>
                </tr>
                <tr class="ttsconfig ttsbaseconfig colmp3">
                    <td style="width: 25%">
                        <label id="lmp3store"><TMPL_VAR T2S.LABEL_MP3_FILES></label>
                    </td>
                    <td style="width: 50%">
                        <table border=0 width="100%">
                            <tr>
                                <td width="19%">
                                    <select id="mp3store" name="mp3store" data-mini="true" data-native-menu="false" width="50%">
									<option value="1"><TMPL_VAR T2S.1DAY_MP3_STORE></option>
									<option value="7"><TMPL_VAR T2S.7DAY_MP3_STORE></option>
									<option value="30"><TMPL_VAR T2S.30DAY_MP3_STORE></option>
									<option value="365"><TMPL_VAR T2S.365DAY_MP3_STORE></option>
									<option value="0"><TMPL_VAR T2S.ENDLESS_MP3_STORE></option>
								</select>
                                    <script>
                                        $('#mp3store option[value="<TMPL_VAR MP3.MP3store>"').prop('selected', 'selected');
                                    </script>
                                </td>
                                <td>
                                    <table border=0 width="100%">
                                        <tr>
                                            <td style="height: 30px; text-align: center; width: 34%;">
                                                <label id="lfile_gong"><TMPL_VAR T2S.LABEL_MP3_FILE></label>
                                            </td>
                                            <td style="height: 30px">
                                                <select id='file_gong' name='file_gong' data-mini='true' 
													data-validation-error-msg="<TMPL_VAR T2S.SELECT_JINGLE_DROPDOWN>" 
													data-validation-rule="^([A-Za-z0-9]){4,10}$" style="width: 244px">
													<option selected='true' value='' disabled><TMPL_VAR T2S.SELECT_JINGLE_DROPDOWN></option>
													<TMPL_VAR MP3_LIST>
												</select>
                                                <script>
                                                    $('#file_gong').val('<TMPL_VAR MP3.file_gong>');
                                                </script>

                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                        <td valign="middle" style="height: 60px; width: 100px;">
                            &nbsp;
                        </td>
                        
                </tr>

                <tr class="ttsconfig ttsbaseconfig colcachesize">
                    <td style="height: 60px; width: 25%;">
                        <label id="lcachesize"><TMPL_VAR T2S.LABEL_CACHESIZE></label>
                    </td>
                    <td width="50%" style="height: 60px">
                        <input type="range" name="cachesize" id="cachesize" value="<TMPL_VAR MP3.cachesize>" min="100" max="5000" step="100">
                    </td>
                    <td style="height: 30px; width: 201px;">
                    </td>
                    
                </tr>

                <tr class="ttsconfig ttsbaseconfig colmp3path">
                    <td style="height: 60px; width: 25%;">
                        <label id="lcard1"><TMPL_VAR T2S.LABEL_SOUNDCARD></label>
                    </td>
                    <td id="mypath" name="mypath" style="height: 60px; width: 25%;">
                        <TMPL_VAR STORAGEPATH>
                            <font size="-1">
                                <TMPL_VAR T2S.JINGLE_SOURCE>
                            </font>
                            <font size="-1" color="blue">
                                <TMPL_VAR DATADIR>/tts/</font>
                    </td>
                    <td style="height: 60px; width: 201px;">
                        <font size="-1">
                            <TMPL_VAR T2S.LABEL_SONOS_FOLDER1>
                        </font>
                        <font size="-1" color="blue"><b><TMPL_VAR T2S.LABEL_SONOS_FOLDER2></b></font>
                        <font size="-1">
                            <TMPL_VAR T2S.LABEL_SONOS_FOLDER3>
                        </font>
                        <font size="-1" color="blue"><b><TMPL_VAR T2S.LABEL_SONOS_FOLDER4></b></font>
                        <font size="-1">
                            <TMPL_VAR T2S.LABEL_SONOS_FOLDER5>
                        </font>
                    </td>
                    
                </tr>

                <tr class="ttsconfig ttsbaseconfig">
                    <td style="height: 60px; width: 25%;">
                        <label id="lsendlox"><TMPL_VAR T2S.DATA_TRANSFER_MINISERVER></label>
                    </td>
                    <td width="5%" style="height: 60px">
                        <table border=0 width="100%">
                            <tr>
                                <td style="width: 6%">
                                    <fieldset>
                                        <select onchange="selection()" id="sendlox" name="sendlox" data-role="flipswitch" style="width: 104px">
										<option value="false"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
										<option value="true"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
										</select>
                                    </fieldset>
                                    <script>
                                        $('#sendlox').val('<TMPL_VAR LOXONE.LoxDaten>')
                                    </script>
                                </td>
                                <td style="width: 23px; text-align: center;">
                                    &nbsp;</td>
                                <td>
                                    <table border=0 style="width: 95%">
                                        <tr>
                                            <td class="field_ms" align="left" style="width: 50%">
                                                <TMPL_VAR MS>
											<td class="field_ms" style="width: 84px;">
													<fieldset>
														<div id="add">
												
														</div>
													</fieldset>
												<script>
												if ('<TMPL_VAR MQTT>' == 'true')   {
													document.getElementById("add").innerHTML += '<select onchange="selection()" id="sendloxMQTT" name="sendloxMQTT" data-role="flipswitch" data-wrapper-class="custom-mscom-flipswitch"><option value="false"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON_MS></option><option value="true"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF_MS></option></select>';
													$('#sendloxMQTT').val('<TMPL_VAR LOXONE.LoxDatenMQTT>');
												} else {
													document.getElementById("add").innerHTML += '<input id="sendloxMQTT" name="sendloxMQTT" type="hidden" value="false">';
												}
												</script>
											</td>
                                            </td>
											
                                            <td class="field_lab_udp" align="right" style="width: 30%">
                                                <TMPL_VAR T2S.LABEL_UDP_PORT>
                                            </td>
                                            <td class="field_udp" style="width: 20px">
                                                <input id="udpport" name="udpport" type="text" value="<TMPL_VAR LOXONE.LoxPort>" align="left" style="width: 71px;">
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td class="empty_template" style="height: 30px; width: 201px;">
                        <font size="-1">
                            <TMPL_VAR T2S.LABEL_SONOS_DATA_TRANSFER>
                        </font>
                    </td>
                    <td class="empty_template" style="height: 30px; width: 24px;">
                        <font size="-1">
                            <div id="testurl">
                            </div>
                        </font>

                    </td>
                </tr>
				
                <tr class="empty_template">
                    <td class="empty_template" style="height: 60px; width: 25%;">
                        <label id="ltemplate"><TMPL_VAR T2S.LABEL_TEMPLATE></label>

                    </td>
                    <td class="empty_template" width="50%" style="height: 60px">
                        <table border=0 width="100%">
                            <tr>
                                <td class="empty_template" style="width: 5%">
								    <div class="btn">
										<input type="button" onclick="checkfile('VI_UDP_Sonos.xml')" id="btn1" data-mini="true" value="VI_UDP_Sonos.xml" />
									</div>								
								
									<div class="btnc">
                                        <input type="button" onclick="checkfile('VI_MQTT_UDP_Sonos.xml')" id="btn2" data-mini="true" value="VI_MQTT_UDP_Sonos.xml" />
									</div>
									<td style="width: 5%">
										<div class="btnd">
											<input type="button" onclick="checkfile('VI_MQTT_HTTP_Sonos.xml')" id="btn3" data-mini="true" value="VI_MQTT_HTTP_Sonos.xml" />
										</div>
									</td>
								</td>
                                <td class="empty_template" style="width: 25%"></td>
                            </tr>
                        </table>
						<td class="empty_template" style="width: 50%; height: 60px;">
                            <font size="-1">
                                <TMPL_VAR T2S.HELP_TEMPLATE>
								<a id="lwiki" target="_blank">
									<TMPL_VAR T2S.HELP_TEMPLATE_END>
								</a>
                            </font>
                        </td>
					</td>
                        <td class="empty_template" style="height: 30px; width: 201px;">
                        </td>
                        <td class="empty_template" style="height: 30px; width: 24px;">
                            <font size="-1">
                                <div id="testurl">
                                </div>
                            </font>
                        </td>
                </tr>




                <!-- Options-->
                <tr>
                    <td colspan=3 style="height: 30px; ">
                        <hr/>
                        <h3><TMPL_VAR TEMPLATE.MAIN_LABEL_OPTIONS></h3>
                    </td>
                </tr>
                <td style="height: 30px; width: 10%;">
                    <TMPL_VAR TEMPLATE.LABEL_OPTIONS>
                </td>
                <td colspan=3 valign="middle">
                    <div style="display:table-cell; width:60%;">
                        <div style="display:table; border-spacing: 10; border-radius: 20px; border: 8px solid #9a9b98; border-radius: 20px; background-color: #6dac20;">
                            <fieldset data-role="controlgroup">
                                <div style="display:table-row;">
                                    <div style="display:table-cell;">
                                        <input name="Checkbox2" type="checkbox" onclick="radlayout() " id="radio_det" data-icon="check" style="width: 142px">
                                        <label for="radio_det"><TMPL_VAR RADIO.LAYOUT_CHECKBOX></label>
                                    </div>
                                    <div style="display:table-cell;">
                                        <input name="Checkbox3" type="checkbox" onclick="weatherlayout()" id="weather_det" data-icon="check" style="width: 142px">
                                        <label for="weather_det"><TMPL_VAR WEATHER.LAYOUT_CHECKBOX></label>
                                    </div>
                                    <div style="display:table-cell;">
                                        <input name="Checkbox4" type="checkbox" onclick="destlayout()" id="dest_det" data-icon="check" style="width: 142px">
                                        <label for="dest_det"><TMPL_VAR DESTINATION.LAYOUT_CHECKBOX></label>
                                    </div>
                                    <div style="display:table-cell;">
                                        <input name="Checkbox5" type="checkbox" onclick="callayout()" id="cal_det" data-icon="check" style="width: 142px">
                                        <label for="cal_det"><TMPL_VAR CALENDAR.LAYOUT_CHECKBOX></label>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </td>


                <!-- Start Radio-->

                <tr class="radiodet">
                    <td colspan=3 valign="middle" style="height: 33px">
                        <hr />
                        <h3>
                            <TMPL_VAR RADIO.HEADER_RADIO>
                        </h3>
                    </td>
                    <td style="height: 33px; width: 24px;"></td>
                    <tr class="radiodet">
                        <td colspan=3 valign="middle" style="height: 36px"> 
                            <font size="-1">
                                <TMPL_VAR RADIO.NOTE_RADIO>
                            </font>
                            <p></p>
                            <table class="tables" width="100%" id="tblBasic2">
                                <tr class="radiodet">
                                    <th><img class='ico_delete' src='/plugins/<TMPL_VAR PLUGINDIR>/images/recycle-bin.png' border='0' width='24' height='24'></th>
                                    <th align="left" style="height: 25px; width: 210px"><TMPL_VAR RADIO.RADIO_STATION_NAME></th>
                                    <th align="left"><TMPL_VAR RADIO.RADIO_STATION_URL></th>
									<th align="left"><TMPL_VAR RADIO.RADIO_STATION_COVER_URL></th>
                                </tr class="radiodet">
                                <TMPL_VAR ROWSRADIO>
                            </table>
                            <a onClick="AddRadio();return false;" id="btnaddradio" data-role="button" data-inline="true" data-mini="true" data-icon="plus" href="#">
                                <TMPL_VAR RADIO.BUTTON_ADD_STATION>
                            </a>
                    </tr>

                    <!-- End Radio-->


                    <!-- Start Destination -->

                    <tr class="destdet">
                        <td colspan=3 valign="middle" style="height: 33px">
                            <h3>&nbsp;</h3>
                            <hr />
                            <h3>
                                <TMPL_VAR DESTINATION.HEADER>
                            </h3>
                        </td>
                    </tr>
                    <tr class="destdet">
                        <td colspan=3 valign="middle" style="height: 37px">
                            <font size="-1">
                                <TMPL_VAR DESTINATION.NOTE>
                                    <a href="<TMPL_VAR DESTINATION.LINK_GOOGLE>"></a>
                            </font>
                        </td>
                    </tr>

                    <tr class="destdet">
                        <td style="height: 48px; width: 25%">
                            <label id="lapikey"><TMPL_VAR DESTINATION.LABEL_GOOGLE_API></label>
                        </td>
                        <td style="width: 50%; height: 48px">
                            <input id="googlekey" name="googlekey" type="text" class="textfield" value="<TMPL_VAR LOCATION.googlekey>">
                        </td>
                        <td style="height: 48px; width: 201px;" class="auto-style4">
                            <font size="-1">
                                <a id="linkgoogle" href="<TMPL_VAR DESTINATION.LINK_GOOGLE_DISTANCE>" target="_blank">
                                    <TMPL_VAR DESTINATION.LABEL_GOOGLE_DISTANCE>
                                </a>
                            </font>
                        </td>
                    </tr>


                    <td class="destdet" style="width: 25%">
                        <TMPL_VAR DESTINATION.LABEL_GOOGLE_REGION>
                            <label style="font-size: x-small;" id="lexample"><TMPL_VAR DESTINATION.LABEL_GOOGLE_EXAMPLE></label>
                    </td>
                    <td style="width: 10%">
                        <table border=0 width="100%">
                            <tr class="destdet">
                                <td style="width: 41%">
                                    <input id="googletown" name="googletown" type="text" class="textfield" value="<TMPL_VAR LOCATION.googletown>" style="width: 215px">
                                </td>
                                <td>
                                    <table border=0 width="100%">
                                        <tr class="destdet">
                                            <td style="height: 30px; width: 24%; text-align: center;">
                                                <TMPL_VAR DESTINATION.LABEL_ADDRESS>
                                            </td>
                                            <td style="height: 30px">
                                                <input id="googlestreet" name="googlestreet" type="text" class="textfield" value="<TMPL_VAR LOCATION.googlestreet>" style="width: 231px">
                                            </td>

                                        </tr>
                                    </table>
                            </tr>
                            <tr class="destdet">
                                <td colspan=3 valign="middle" style="height: 33px">
                                    <h3></h3>
                                </td>
                            </tr>
                        </table>

                        <!-- End Destination-->


                        <!-- Start Kalender-->

                        <tr class="caldet">
                            <td colspan=3 valign="middle" style="height: 33px">
                                <hr/>
                                <h3>
                                    <a target="_blank">
                                        <TMPL_VAR CALENDAR.HEADER>
                                    </a>
                                </h3>
                            </td>
                        </tr>
                        <tr class="caldet">
                            <td style="height: 48px; width: 25%">
                                <label id="lwastecal"><TMPL_VAR CALENDAR.WASTE_LABEL></label>
                            </td>
                            <td style="width: 50%; height: 48px">
                                <input id="wastecal" name="wastecal" type="text" class="textfield" value="<TMPL_VAR VARIOUS.CALDavMuell>">
                            </td>
                            <td style="height: 48px; width: 201px;" class="auto-style4">
                                <input name="val_t2s" id="val_t2s" class="textfield" value="<TMPL_VAR T2S_ENGINE>" type="hidden" style="width: 96px">
                                <input name="lblang" id="lblang" class="textfield" value="<TMPL_VAR LBLANG>" type="hidden" style="width: 96px">
                            </td>
                            <tr class="caldet">
                                <td style="height: 48px; width: 25%">
                                    <label id="lcal"><TMPL_VAR CALENDAR.CALENDAR_LABEL></label>
                                </td>
                                <td style="width: 50%; height: 48px">
                                    <input id="cal" name="cal" type="text" class="textfield" value="<TMPL_VAR VARIOUS.CALDav2>">
                                </td>
                                <td style="height: 48px; width: 201px;" class="auto-style4">
                                    <input name="val_voice" id="val_voice" type="hidden" class="textfield" value="<TMPL_VAR VOICE>" style="width: 93px">
                                    <input name="val_code" id="val_code" type="hidden" class="textfield" value="<TMPL_VAR CODE>" style="width: 93px">
                                </td>
                                <tr class="caldet">
                                    <td colspan=3 valign="middle" style="height: 33px">
                                        <h3></h3>
                                    </td>
                                </tr>

                                <!-- Ende Kalender-->

                                <!-- Start Weather-->
                                <tr class="weatherdet">
                                    <td colspan=3 valign="middle" style="height: 33px">
                                        <hr/>
                                        <h3>
                                            <TMPL_VAR WEATHER.HEADER_WEATHER>
                                        </h3>
                                    </td>
                                </tr>
                                <tr class="weatherdet">
                                    <td colspan=3 style="height: 23px; width: 70%">
                                        <font size="-1">
                                            <TMPL_VAR WEATHER.NOTE_WEATHER>
                                        </font>
                                    </td>
                                </tr>
                                <tr class="weatherdet">
                                    <td style="height: 56px">
                                        <TMPL_VAR WEATHER.REGION>
                                    </td>
                                    <td style="width: 50%; height: 56px;">
                                        <table border=0 width="100%">
                                            <tr class="weatherdet">
                                                <td width="20%" style="height: 30px">
                                                    <select id="region" name="region" data-mini="true" style="width: 102px">
														<option value="baw"><TMPL_VAR WEATHER.REGION1></option>
														<option value="bay"><TMPL_VAR WEATHER.REGION2></option>
														<option value="bbb"><TMPL_VAR WEATHER.REGION3></option>
														<option value="hes"><TMPL_VAR WEATHER.REGION4></option>
														<option value="mvp"><TMPL_VAR WEATHER.REGION5></option>
														<option value="nib"><TMPL_VAR WEATHER.REGION6></option>
														<option value="nrw"><TMPL_VAR WEATHER.REGION7></option>
														<option value="rps"><TMPL_VAR WEATHER.REGION8></option>
														<option value="sac"><TMPL_VAR WEATHER.REGION9></option>
														<option value="saa"><TMPL_VAR WEATHER.REGION10></option>
														<option value="shh"><TMPL_VAR WEATHER.REGION11></option>
														<option value="thu"><TMPL_VAR WEATHER.REGION12></option>
													</select>
                                                    <script>
                                                        $('#region').val('<TMPL_VAR LOCATION.region>');
                                                    </script>
                                                </td>
                                                <td style="height: 30px">
                                                    <td width="50%" style="height: 30px; text-align: center;">
                                                        <TMPL_VAR WEATHER.TOWN>
                                                    </td>
                                                    <td style="height: 30px"><input id="town" name="town" type="text" class="textfield" value="<TMPL_VAR LOCATION.town>"></td>
                                            </tr>
                                        </table>
                                        <td valign="middle" style="height: 60px; width: 201px; font-size: smaller;">
                                            <a id="linkdwd" href="<TMPL_VAR WEATHER.LINK_WEATHER_SERVICE>" target="_blank">
                                                <TMPL_VAR WEATHER.LABEL_WEATHER_SERVICE>
                                            </a><br>
                                            <a id="linkpollen" href="<TMPL_VAR WEATHER.LINK_ALLERGEN>" target="_blank">
                                                <TMPL_VAR WEATHER.LABEL_ALLERGEN>
                                            </a>
                                        </td>
                                        <tr class="weatherdet">
                                            <td colspan=3 valign="middle" style="height: 33px">
                                                <h3></h3>
                                            </td>
                                        </tr>
                                        </td>
                                        <!-- Ende Weather-->


                                        <!-- Ende-->

            </table>
            <td></td>
            <p>
                <center>
                    <button type="submit" form="main_form" id="btnsubmit" data-role="button" data-inline="true" data-mini="true" data-icon="check"><TMPL_VAR SAVE.SAVE_BUTTON></button>
				</center>
				<script>
				
				</script>
            </p>
        </div>
		
		<!-- Donation -->
        <div data-role='collapsible' id='coll_donate' data-content-theme='true' data-collapsed='true' data-collapsed-icon='carat-d' data-expanded-icon='carat-u' data-iconpos='right'>
            <h2 class='ui-bar ui-bar-a ui-corner-all' id='head_donate'>
                <TMPL_VAR BASIS.DONATE_HEADER>
            </h2>
            <TMPL_VAR donate>
                <div style="margin:auto;text-align:left;">
                    <br>
                    <label id="lexample"><TMPL_VAR BASIS.DONATE_TEXT></label>
                </div>
                <div style="margin:auto;text-align:left;">
                    <br>
                    <!--<li><a href="https://www.ikea.com/de/de/news/symfonisk-regal-wifi-speaker-und-tischleuchte-mit-wifi-speaker-pub0f4bd579" target="_blank">Link zur Preview Seite</a> </li>-->
                </div>
                <div style="margin:auto;text-align:center;">
                    <br>
                    <a href="https://paypal.me/olewald" target="_blank"><img src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" alt="Donate with PayPal.me" /></a>
                </div>
                <br>
                <div style="display:flex;justify-content:center;align-content:space-around;">
                    <div style="padding: 10px 10px 10px 10px;">
                        <fieldset data-role="controlgroup">
                            <input type="checkbox" name="donate" id="donate" <TMPL_VAR DONATE>>
                            <label for="donate"><TMPL_VAR BASIS.DONATE_DONE_REMOVE></label>
                        </fieldset>
                    </div>
                    <div style="padding: 10px 10px 10px 10px;">
                        <button type="submit" form="main_form" id="btnsubmit" data-role="button" data-inline="true"><TMPL_VAR SAVE.SAVE_BUTTON></button>
                    </div>
                </div>
        </div>
        <!-- Ende Donation -->
    </form>
	

	<!-- Speech SDK reference sdk. -->
	
	<script src="/plugins/<TMPL_VAR PLUGINDIR>/voice_engines/bin/Microsoft/microsoft.cognitiveservices.speech.sdk.bundle.js"></script>
	<script>
        //***************** Functions to be executed during loading the page **********************
		
		//console.log(config);
        $(document).on('pageinit', function() {
				selection();
				callayout();
				destlayout();
				radlayout();
				weatherlayout();
				donation();
				//getsbconfig();
				//getradio();
			});
			var tvmonerr = "true";		
		
		// play test soundfile when Elevenlabs used
		function playprev()    {
		    var selectElement = document.getElementById("voice");
			var file = (selectElement.options[selectElement.selectedIndex].id);
			let beat = new Audio(file);
			beat.play();
		};
		
		function checkboxes() {
			//console.log('checkboxes');
			// get count of players for iteration
			var iteration = document.getElementById('countplayers').value;
            iteration = parseInt(iteration)
            iteration += 1;
			// loop through players
			for (i = 1; i < iteration; ++i) {
				if (document.getElementById('mainchk' + i).value == "on") {
					document.getElementById('mainchk' + i).checked = true;
					$('input:checkbox').checkboxradio('refresh');
				} else {
					document.getElementById('mainchk' + i).checked = false;
					$('input:checkbox').checkboxradio('refresh');
				}
			}
			return;
		}
		

		
		function t2slayout() {
            if (document.main_form.t2s_det.checked == true) {
                $(".t2sdet").show();
            } else {
                $(".t2sdet").hide();
            }
        }

        function callayout() {
            if (document.main_form.cal_det.checked == true) {
                $(".caldet").show();
            } else {
                $(".caldet").hide();
            }
        }

        function destlayout() {
            if (document.main_form.dest_det.checked == true) {
                $(".destdet").show();
            } else {
                $(".destdet").hide();
            }
        }

        function radlayout() {
            if (document.main_form.radio_det.checked == true) {
                $(".radiodet").show();
            } else {
                $(".radiodet").hide();
            }
        }

        function weatherlayout() {
            if (document.main_form.weather_det.checked == true) {
                $(".weatherdet").show();
            } else {
                $(".weatherdet").hide();
            }
        }

        function donation() {
            if (document.getElementById('donate').checked) {
                $("#coll_donate").hide();
            } else {
                $("#coll_donate").show();
            }
        }



        //**************************** Block for Layout control ************************************




        // function to disable/enable some fields on click depending on selected value
        function prepareTTSConfigFields() {
            console.log("prepareTTSConfigFields");
            const selectedEngine = $('#engine-selector input:checked');
            if (selectedEngine) {
                var test = $('.ttsconfig').not('.' + selectedEngine.val()).not('.ttsbaseconfig').hide();
                $('.' + selectedEngine.val() + ', .ttsbaseconfig').show();
            } else {
                $('.ttsconfig').hide();
            }
			 // T2S INSTANZ
            if (document.getElementById('tts_voicerss').checked == true) {
                $('#voice').addClass('ui-disabled');
            } else if (document.getElementById('tts_azure').checked == true) {
                $('#voice').addClass('ui-disabled');
            } else if (document.getElementById('tts_elevenlabs').checked == true) {
                $('#voice').removeClass('ui-disabled');
                $('#voice').selectmenu('refresh', true);
            } else if (document.getElementById('tts_polly').checked == true) {
                $('#voice').removeClass('ui-disabled');
                $('#voice').selectmenu('refresh', true);
            } else if (document.getElementById('tts_google_cloud').checked == true) {
                $('#voice').addClass('ui-disabled');
            }
			$('#t2slang').selectmenu('refresh', true);
			$('#voice').selectmenu('refresh', true);
            populateLanguageAndVoiceFields();
        }

        
		// make fields visible in case flipswitch value is true/false
        function selection() {
			console.log("Selection");
            var cat = document.getElementById('sendlox').value;
			var mqtt = document.getElementById('sendloxMQTT').value;
			if (cat == "true") {
				console.log("Communication to Loxone turned on");
                $('#udpport').removeClass('ui-disabled');
                $('.field_ms').show();
                $('.label_template').show();
                $('.template').show();
                $('.empty_template').show();
				if (mqtt == "true") {
					console.log("MQTT selected");
					$('.field_lab_udp').hide();
					$('.field_udp').hide();
					$('.btn').hide();
					$('.btnc').show();
					$('.btnd').show();
				} else {
					console.log("UDP selected");
					$('.field_lab_udp').show();
					$('.field_udp').show();
					$('.btnc').hide();
					$('.btnd').hide();
					$('.btn').show();
					//validate_enable('#udpport');
					//validate_chk_object(['#udpport']);
				}
            } else {
				console.log("Communication to Loxone turned off");
                $('#udpport').addClass('ui-disabled');
                $('.field_ms').hide();
                $('.field_udp').hide();
                $('.field_lab_udp').hide();
                $('.label_template').hide();
                $('.template').hide();
                $('.empty_template').hide();
            }
            $("#sendlox").flipswitch("refresh");
            $('#miniserver').selectmenu('refresh', true);
        }
		
		
		// prepare the voice list dependend on language list
        function populateVoice() {
            console.log("populateVoice");
            if (document.main_form.tts_polly.checked == true) {
                var selectedlanguage = $("#t2slang option:selected").val();
                //console.log("popvoice" + selectedlanguage);
                if (selectedlanguage) {
                    $('#voice').empty();
                    $('#voice').removeClass('ui-disabled');
                    const url = "/plugins/<TMPL_VAR PLUGINDIR>/voice_engines/langfiles/polly_voices.json";
                    $.getJSON(url, function(listvoice) {
                        $('#voice').append('<option selected="true" value="" disabled><TMPL_VAR T2S.SELECT_VOICE_DROPDOWN></option>');
                        var selectedvoiceList = listvoice.filter(function(item) {
                            return item.language === selectedlanguage;
                        });
                        $.each(selectedvoiceList, function(index, value) {
                            if (value.name == '<TMPL_VAR VOICE>') {
                                $('#voice').append('<option selected="selected" value="' + value.name + '">' + value.name + '</option>');
                            } else {
                                $('#voice').append('<option value="' + value.name + '">' + value.name + '</option>');
                            }
                            $('#voice').selectmenu('refresh', true);
                        });
                    });
                }
            } else if (document.main_form.tts_google_cloud.checked == true) {
                const currentLanguage = $("#t2slang").val();
                var tempVal = "";
                if ($("#voice option:selected") && $("#voice option:selected").attr('data-lang') == currentLanguage) {
                    tempVal = $("#voice").val();
                }
                const savedVoice = '<TMPL_VAR VOICE>';
                $("#voice > option").each(function(index, element) {
                    if (element.getAttribute('data-lang') == currentLanguage || !currentLanguage) {
                        $("#voice option[value=" + element.value + "]").show();
                        if (tempVal == "" && element.value == savedVoice) {
                            tempVal = element.value;
                        }
                    } else {
                        $("#voice option[value=" + element.value + "]").hide();
                    }
                });
                if (tempVal) {
                    $('#voice').val(tempVal);
                } else {
                    $('#voice').prop('selectedIndex', 0);
                }
            } else {
                $('#voice').empty();
            }
			if (document.main_form.tts_elevenlabs.checked == true) {
				populateElevenlabsVoices();
			}
            $('#voice').selectmenu('refresh', true);
			$('#t2slang').selectmenu('refresh', true);

            // generate language ISO Code
            var isocode = '<TMPL_VAR CODE>'.substr(0, 2);
            $('#langiso').val(isocode);
            $("#langiso").textinput("refresh");
        }

        // Sets correct language if voice gets selected before language
        function setCorrectLang() {
			console.log('setCorrectLang');
            if (document.main_form.tts_google_cloud.checked == true) {
                var selectedlanguage = $("#t2slang").val();
                if ($("#voice").find("option:selected").attr('data-lang') != selectedlanguage) {
                    $('#t2slang option[value="' + $("#voice").find("option:selected").attr('data-lang') + '"]').attr("selected", "selected");
					$('#t2slang').selectmenu('refresh', true);
				}
            }
        }



		

        function populateGoogleCloudVoices() {
			console.log("populateGoogleCloudVoices");
			if ($('#apikey').val()) {
                const url = "https://texttospeech.googleapis.com/v1/voices?key=" + $('#apikey').val();
                var getCountryNames = new Intl.DisplayNames([navigator.language || navigator.userLanguage], {
                    type: 'region'
                });
                $('#t2slang').empty();
                $('#voice').empty();
                fetch(url).then(function(response) {
				//console.log(response);
                    if (response.status != 200) {
						if (($('#apikey').val().length == 39))  {
							dialog('<TMPL_VAR T2S.VOICE_ERROR1>: ' + response.status + '. <TMPL_VAR T2S.VOICE_ERROR2>: ' + $('#apikey').val() + ' <TMPL_VAR T2S.VOICE_ERROR3>', 'OK', 'error', 'Google Cloud Voice');
							$('#t2slang').empty();
							$('#voice').empty();
							$('#t2slang').selectmenu('refresh', true);
							$('#voice').selectmenu('refresh', true);
							return;
						}
                    }
                    return response.json();
                }).then(function(data) {
                    if (!data) {
	                    return;
                    }
					const langs = new Map();
                    const voices = new Map();
					console.log(data.voices); // 65 = {languageCodes: Array(1), name: 'de-DE-Wavenet-D'
					console.log(langs); // 18 = {"de-DE" => "Deutschland"}
                    const savedLanguageCode = '<TMPL_VAR CODE>'.substring(0,5);
                    data.voices.forEach(element => {
                        if (element.languageCodes.length > 0 && element.languageCodes[0].length == 5) {
                            lanIsoCode = element.languageCodes[0];
                            countryIsoCode = lanIsoCode.substring(3);
                            countryname = getCountryNames.of(countryIsoCode);
                            langs.set(lanIsoCode, countryname);
                            voices.set(element.name, lanIsoCode);
                        }
                    });
                    langs.forEach(function(langname, langcode) {
                        $('#t2slang').append('<option value="' + langcode + '">' + langname + '</option>');
                    });
					if (savedLanguageCode) {
                          $('#t2slang').val(savedLanguageCode); //z.B. de-DE
                    } else {
						defaultvoice = 'de-DE';
                        $('#t2slang').prop('selectedIndex', 0);
                    }
                    voices.forEach(function(locale, voicename) {
                        $('#voice').append('<option value="' + voicename + '" data-lang="' + locale + '">' + voicename + '</option>');
                    });
					//errorvoice = 'true';
                    populateVoice();
                    $('#voice').removeClass('ui-disabled');
                    $('#t2slang').removeClass('ui-disabled');
                    $('#t2slang').selectmenu('refresh', true);
                    $('#voice').selectmenu('refresh', true);
                });
            }
        }



        //*************************End Block for Layout control ************************************


        // Function to add new radiostations to config
        function AddRadio() {

            // Total number of Radios
            var iteration = document.getElementById('countradios').value;
            iteration = parseInt(iteration)

            var tbl = document.getElementById('tblBasic2');

            // Del 1. row if there where no radios
            if (iteration < 1) {
                var row = tbl.deleteRow(-1);
            }

            var lastRow = tbl.rows.length;
            iteration += 1;
            document.getElementById("countradios").value = iteration;

            // Add cells
            var row = tbl.insertRow(lastRow);
            var cellRight = row.insertCell(0);
            cellRight.innerHTML = '<tr><td style="height: 25px; width: 43px; text-align: center;"><INPUT type="checkbox" style="width: 20px" name="chkradios' + iteration + '" id="chkradios' + iteration + '" align="center"/></td>'
            var cellRight = row.insertCell(1);
            cellRight.innerHTML = '<td style="height: 28px"><input type="text" id="radioname' + iteration + '" name="radioname' + iteration + '" size="20" value="" /> </td>'
            var cellRight = row.insertCell(2);
            cellRight.innerHTML = '<td style="width: 600px; height: 28px"><input type="text" id="radiourl' + iteration + '" name="radiourl' + iteration + '" size="100" value="" style="width: 100%" /> </td>'
			var cellRight = row.insertCell(3);
            cellRight.innerHTML = '<td style="width: 600px; height: 28px"><input type="text" id="coverurl' + iteration + '" name="coverurl' + iteration + '" size="100" value="" style="width: 100%" /> </td></tr>'
            // Recreate JQUERY styles
            $("#main_form").trigger('create');

        }

        //******************************* Scan for Players *****************************************
        function Scan() {

            url = './index.cgi?do=scan';
            document.location.href = url;

        }
		
		
        //************************ Prepare screen during initial load*** *****************************
        function initial_lang_voice_load() {
            console.log("initial_lang_voice_load");
            // if screen is initial, no T2S engine selected
            if (!$('#val_t2s').val()) {
                $('.ttsconfig').hide();
            } else {
                console.log("selecting engine: " + $('#val_t2s').val());
                $('#engine-selector input[value="' + $('#val_t2s').val() + '"]').prop('checked', true).checkboxradio("refresh");
				$('#t2slang').selectmenu('refresh', true);
				$('#voice').selectmenu('refresh', true);
                prepareTTSConfigFields();
            }
        };

        //************************ Prepare Document ready layout ********************************

        function populateLanguageBasedOnJSON(url) {
            console.log("populateLanguageBasedOnJSON");
            $.getJSON(url, function(listlang) {
                $.each(listlang, function(index, value) {
                    $('#t2slang').append('<option value="' + value.value + '">' + value.country + '</option>');
                });
                if ('<TMPL_VAR CODE>') {
                    //console.log("Selecting CODE: " + '<TMPL_VAR CODE>');
                    $('#t2slang').val('<TMPL_VAR CODE>');
                }
                $('#t2slang').selectmenu('refresh', true);
                populateVoice();
            });

        }
		
		
		function checkProvider() {
			if (document.main_form.tts_google_cloud.checked == true) {
				populateGoogleCloudVoices();
			}
			if (document.main_form.tts_azure.checked == true) {
				populateAzureVoices();
			}
			if (document.main_form.tts_elevenlabs.checked == true) {
				populateElevenlabsLang();
			}
		}
		

//************************ Prepare Elevenlabs ********************************	
	
		function populateElevenlabsLang()   {
			console.log("populateElevenlabsLang");
			if (document.main_form.tts_elevenlabs.checked == true) {
				var url = 'https://api.elevenlabs.io/v1/models';
				$('#t2slang').empty();
				//var key = document.getElementById('apikey').value;
				var key = "77ba25e2758b20cb43867c8926ef30d0";
				const options = {method: 'GET', headers: {"xi-api-key": "" + key + ""}};
				fetch(url, options)
					.then(response => response.json())
					.then(function(data)  {
						//console.log("Daten: " + data[0]);
						if (data[0] === undefined) {
							text = ("Elevenlabs Error: " + data.detail.message);
							//message(text);
							dialog(text, 'OK', 'error', 'Elevenlabs language');
							return false;
						} else {
							let lang = data[0]['languages'];
							$('#t2slang').append('<option selected="true" value="" disabled><TMPL_VAR T2S.SELECT_LANGUAGE_DROPDOWN></option>');
							lang.forEach((lang, index) => {
								if (lang.language_id == "<TMPL_VAR TTS.messageLang>")   {
									$('#t2slang').append("<option selected='selected' value=\"" + lang.language_id + "\">&nbsp;" + lang.name + "</option>");
								} else {
									$('#t2slang').append("<option value=\"" + lang.language_id + "\">&nbsp;" + lang.name + "</option>");
								}
							})
							$('#t2slang').selectmenu('refresh', true);
						}
					})
					.catch(err => (err));
					//dialog(err, 'OK', 'error', 'Elevenlabs language');
					populateElevenlabsVoices();
				};
			};
		
		
		function populateElevenlabsVoices()   {
			console.log("populateElevenlabsVoices");
			$('#voice').empty();
			//var key = document.getElementById('apikey').value;
			var key = "77ba25e2758b20cb43867c8926ef30d0";
			const options = {method: 'GET', headers: {"xi-api-key": "" + key + ""}};
			var url = 'https://api.elevenlabs.io/v1/voices';
			fetch(url, options)
				.then(response => response.json())
				.then(function(data)  {
					let voice = data['voices'];
					//console.log("Daten: " + voice);
					if (voice === undefined) {
						text = ("Elevenlabs Error: " + data.detail.message);
						//message(text);
						dialog(text, 'OK', 'error', 'Elevenlabs Voice');
						return false;
					} else {
						//console.log(voice);
						$('#voice').append('<option selected="true" value="" disabled><TMPL_VAR T2S.SELECT_VOICE_DROPDOWN></option>');
						voice.forEach((voice, index) => {
							if (voice.voice_id == "<TMPL_VAR TTS.voice>")   {
								$('#voice').append("<option selected='selected' id=\"" + voice.preview_url + "\" value=\"" + voice.voice_id + "\">&nbsp;" + voice.name + " - " + voice.labels.age + ", " + voice.labels.description + "</option>");
							} else {
								$('#voice').append("<option id=\"" + voice.preview_url + "\" value=\"" + voice.voice_id + "\">&nbsp;" + voice.name + " - " + voice.labels.age + ", " + voice.labels.description + "</option>");
								//console.log((voice.preview_url));
							}
						})
						$('#voice').selectmenu('refresh', true);
					}
				})
				.catch(err => (err));
				//dialog(err, 'OK', 'error', 'Elevenlabs Voice');
				return;
		};
		
//************************ End of Prepare Elevenlabs ********************************	
			
//************************ Prepare MS Azure ********************************
	  
		// status fields and start button in UI
 		//var	subscriptionKey = document.getElementById("subscriptionKey");
		var	regionOptions = document.getElementById("regionOptions");
		
		function populateAzureVoices()   {
			console.log("populateAzureVoices");
			if ($('#apikey').val()) {
				$('#t2slang').empty();
				$('#voice').empty();
				var request = new XMLHttpRequest();
				request.open('GET',
						'https://' + regionOptions.value + ".tts.speech." +
						(regionOptions.value.startsWith("china") ? "azure.cn" : "microsoft.com") +
								"/cognitiveservices/voices/list", true);
				request.setRequestHeader("Ocp-Apim-Subscription-Key", $('#apikey').val());
				}

			  request.onload = function() {
			  if (request.status >= 200 && request.status < 400) {
				const response = this.response;
				var str = "<TMPL_VAR TTS.messageLang>";
				//console.log(str.substring(6));
				var defvoice = str.substring(6);
				let selectId;
				const data = JSON.parse(response);
				console.log(data);
				data.forEach((voice, index) => {
					$('#t2slang').append("<option value=\"" + voice.ShortName + "\">" + voice.LocaleName + " - " + voice.DisplayName + " - " + voice.Gender + "</option>");
					if (voice.Name.indexOf(defvoice) > 0) {
						selectId = index;
					}
				});
				if (! selectId)  {
					$('#t2slang').prop('selectedIndex', 0);
					$('#t2slang').selectmenu('refresh', true);
				} else {
					$('#t2slang').prop('selectedIndex', selectId);
					$('#t2slang').selectmenu('refresh', true);
				}
				//errorvoice = 'true';
			} else {
				if (($('#apikey').val().length == 32))  {
					console.log('Error Code: ' + this.status);
					dialog('<TMPL_VAR T2S.VOICE_ERROR1>: ' + this.status + '. <TMPL_VAR T2S.VOICE_ERROR2>: ' + $('#apikey').val() + ' <TMPL_VAR T2S.VOICE_ERROR3>', 'OK', 'error', 'Azure Voice');
					$('#t2slang').empty();
					$('#voice').empty();
					$('#t2slang').selectmenu('refresh', true);
                    $('#voice').selectmenu('refresh', true);
					return;
				}
			}
			};
			request.send()
		};

//************************ finished MS Azure ********************************	 
		
        function populateLanguageAndVoiceFields() {
            console.log("populateLanguageAndVoiceFields");
            // load JSON files into dropdwon field language
            const selectedEngine = $('#engine-selector input:checked');
            $('#t2slang').empty();
            $('#voice').empty();
            var url = "/plugins/<TMPL_VAR PLUGINDIR>/voice_engines/langfiles/";
            switch (selectedEngine.val()) {
                case '1001':
                    url = url + "voicerss.json";
                    break;
                case '3001':
                    url = url + "osx.json";
                    break;
                case '4001':
                    url = url + "polly.json";
                    break;
                case '5001':
                    url = url + "pico.json";
                    break;
                case '6001':
                    url = url + "respvoice.json";
                    break;
                case '7001':
                    url = url + "google.json";
                    break;
                case '8001':
                    populateGoogleCloudVoices();
                    break;
				case '9001':
                    populateAzureVoices();
                    break;
				case '9011':
                    populateElevenlabsLang();
                    break;
                default:
                    $('#t2slang').append('<option selected="true" value="" disabled><TMPL_VAR T2S.SELECT_LANGUAGE_DROPDOWN></option>');
                    $('#t2slang').prop('selectedIndex', 0);
                    //$('#voice').append('<option selected="true" value="" disabled><TMPL_VAR T2S.SELECT_VOICE_DROPDOWN></option>');
                    break;
            }
            if (url.endsWith("json")) {
                populateLanguageBasedOnJSON(url);
            }

            $('select').selectmenu();
            $('select').selectmenu('refresh', true);
            // pass ISO code of selected language to field for info
            var isocode = '<TMPL_VAR CODE>'.substr(0, 2);
            $('#langiso').val(isocode);
            $("#langiso").textinput("refresh");
        }
		
		
		// function to download XML Files to Import in Loxone
		function downloadFile(filename) {
			var element = document.createElement('a');
			element.setAttribute('href','/plugins/<TMPL_VAR PLUGINDIR>/system/'  + filename);
			element.setAttribute('download', filename);
			document.body.appendChild(element);
			element.click();
			return;
		}
		
		
		
		function checkfile(filename)   {
			$.post("/plugins/<TMPL_VAR PLUGINDIR>/system/ms_inbound.php");
			var url = '/plugins/<TMPL_VAR PLUGINDIR>/system/'  + filename; 
			var http = new XMLHttpRequest(); 
			http.open('GET', url, false); 
			http.send(); 
			//console.log("http status: " + http.status);
			if (http.status !== 200)  {
				dialog('<TMPL_VAR ERRORS.ERR_XM_TEMP>', 'OK', 'error', 'Check filename');
				$('html, body').animate({
								scrollTop: $("#zone1").offset().top
								}, 500);
								$("#zone1").focus();
								e.preventDefault();
			} else {
				//console.log("Filename: " + filename);
				downloadFile(filename);
			}
		}
		
		// click function to play a Test T2S on clicked Player (Room) in GUI
		$(function(){
			$("#tblzonen").on("click", function(event){
			   var zonetest = event.target.value
			   //console.log("Test: "+zonetest);
			   let response;
			   $.ajax({
					url: '/plugins/<TMPL_VAR PLUGINDIR>/bin/player_on_test.php',
					type: 'post',
					data: { "room": zonetest},
					success: function(response) {}
				}).done(function(response) {
					if(response == true){
						$.post('/plugins/<TMPL_VAR PLUGINDIR>/index.php/?zone=' + zonetest + '&action=say&text=<TMPL_VAR ZONES.SONOS_TEST_PLAYER> ' + zonetest + '&volume=25&playgong=yes');
					}
				});
			});
		});

		// get soundbar config
		function getsbconfig()   {

			$.ajax({
					url: 'index.cgi',
					type: 'post',
					data: { action: 'soundbars'},
					dataType: 'json',
					async: false,
						success: function(data, textStatus, jqXHR )   {
							//console.log(data);
							$.each(data, function(index, valu) {
								if (valu[13] == 'SB')   {
									if (valu[8] == 'SUB' && valu.length == 15) {
										$("#tvmonnightsub_" + index).val(valu[14].tvmonnightsub).flipswitch("refresh");
										$("#subgain_" + index).val(valu[14].tvmonnightsublevel).selectmenu("refresh");
									} else if (valu[8] == 'SUB' && valu.length == 14) {
										$("#tvmonnightsub_" + index).val("false").flipswitch("refresh");
										$("#subgain_" + index).val("0").selectmenu("refresh");
									} else {
										$("#tvmonnightsub_" + index).flipswitch("disable").flipswitch("refresh");
										$("#subgain_" + index).val("0").selectmenu("disable").selectmenu("refresh");
									}
									if (valu[10] == 'SUR' && valu.length == 15) {
										$("#tvmonsurr_" + index).val(valu[14].tvmonsurr).flipswitch("refresh");
									} else if (valu[10] == 'SUR' && valu.length == 14) {
										$("#tvmonsurr_" + index).val("false").flipswitch("refresh");
									} else {
										$("#tvmonsurr_" + index).val('false').flipswitch("disable").flipswitch("refresh");
									}
									if (valu.length == 15)   {
										$("#sbzone_" + index).val(index).text("refresh");
										$("#usesb_" + index).val(valu[14].usesb).flipswitch("refresh");
										$("#tvmonspeech_" + index).val(valu[14].tvmonspeech).flipswitch("refresh");
										$("#tvmonnight_" + index).val(valu[14].tvmonnight).flipswitch("refresh");
										$("#tvmonnightsub_" + index).val(valu[14].tvmonnightsub).flipswitch("refresh");
										$("#fromtime_" + index).val(valu[14].fromtime).selectmenu("refresh");
										$("#tvvol_" + index).val(valu[14].tvvol).text("refresh");
									}
									var usage = document.getElementById("usesb_" + index).value;
									if (usage == "true")   {
										var tvmonvol = document.getElementById("tvvol_" + index).value;
										//console.log("Lnge: " + tvmonvol.length);
										if (tvmonvol.length == 0)    {
											tvmonerr = "false";
										}
										//callback(tvmonerr);
										validate_enable("#tvvol_" + index);
									}
									
								}
							});
						}
					})
				.fail(function (jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.always(function(data) {
					console.log( "Action get Soundbars Config executed" );
				})
		};
		
		
		// check if Soundbar(s) exist and activate template settings
		function validateSB()   {
			var iteration = document.getElementById('countplayers').value;
			var sbyes = "0";
			iteration = parseInt(iteration)
			iteration += 1;
			for (i = 1; i < iteration; ++i) {
				if($('#sb' + i + '').length)   {
					var sbyes = "1";
				}
			}
			//console.log("sbyes: " + sbyes);
			if (sbyes == "1")   {
				$('.tvmon_header').show();
				$('.tvmon_switch').show();
			} else {
				$('.tvmon_header').hide();
				$('.tvmon_switch').hide();
			}
			$("#tvmon").flipswitch("refresh");
		}
		
		// if TV Monitor been used show info   
		function validateTVMon()   {
			var tvmonitor = document.getElementById('tvmon').value;
			if (tvmonitor == "true")   {
				$('.tvmon_header').show();
				$('.tvmon_body').show();
				console.log("TV Monitor On");
			} else {
				$('.tvmon_header').hide();
				$('.tvmon_body').hide();
                console.log("TV Monitor Off");
			}
			$("#tvmon").flipswitch("refresh");
		}
		
		
		// OnChange function for TV Monitor
		$("#tvmon").on("change", function(e){
			var tvmonitor = document.getElementById('tvmon').value;
			if (tvmonitor == "true")   {
				timeout('<TMPL_VAR TEMPLATE.TV_MONITOR_ON>', 'OK', 'info', 'TV Monitor', '4000');
			} else {
				timeout('<TMPL_VAR TEMPLATE.TV_MONITOR_OFF>', 'OK', 'info', 'TV Monitor', '4000');
			}
		});
		
		// pop-up Dailog Box
		function dialog(text, ButtonText, Icon='', Title)    {
			// https://silverboxjs.ir/documentation/?v=latest
			silverBox({
				alertIcon: Icon,
				text: text,
				centerContent: true,
				title: {
						text: Title
						},
				confirmButton: {
								bgColor: "#6dac20",
								border: "10px",
								borderColor: "#6dac20",
								textColor: "#fff",
								text: ButtonText,
								closeOnClick: true
								}
				});
		}
		
		
		// pop-up Timeout Dailog Box
		function timeout(text, ButtonText, Icon='', Title, timeout)    {
			// https://silverboxjs.ir/documentation/?v=latest
			silverBox({
				timer: timeout,
				//alertIcon: Icon,
				customIcon: "/plugins/<TMPL_VAR PLUGINDIR>/web/images/info.svg",
				text: text,
				centerContent: true,
				title: {
						text: Title
						},
				});
		}
		
		// pop-up Dailog Box fr Discover Sonos devices
		function discover()    {
			// https://silverboxjs.ir/documentation/?v=latest
			silverBox({
				alertIcon: 'warning',
				text: '<TMPL_VAR ZONES.SONOS_SCAN_TEXT>',
				footer: "<a href='#'>Auto Discover Sonos</a>",
				centerContent: true,
				title: {
						text: '<TMPL_VAR ZONES.SONOS_SCAN_HEADER>'
						},
				confirmButton: {
								bgColor: "#6dac20",
								border: "10px",
								borderColor: "#6dac20",
								textColor: "#fff",
								text: '<TMPL_VAR ZONES.BUTTON_NEXT>',
								iconStart: "/plugins/<TMPL_VAR PLUGINDIR>/web/images/confirm.svg",
								closeOnClick: false,
								onClick: () => {url = './index.cgi?do=scanning';
												document.location.href = url;
												},
								},
				cancelButton: {
								bgColor: "#6dac20",
								border: "10px",
								borderColor: "#6dac20",
								textColor: "#fff",
								text: '<TMPL_VAR ZONES.BUTTON_BACK>',
								iconStart: "/plugins/<TMPL_VAR PLUGINDIR>/web/images/cancel.svg",
								closeOnClick: true
								},
				});
		}

		
		function message()   {
			//console.log("MESSAGE");
			timeout('<TMPL_VAR SAVE.SAVE_MESSAGE>', 'OK', 'info', '<TMPL_VAR SAVE.SAVE_ALL_OK>', '3500');
		}
		
		

		function refresh()   {
			$("#langiso").textinput("refresh");
			$('#t2slang').selectmenu('refresh');
			$('#voice').selectmenu('refresh');
			//$("#t2slang").html(optionList).selectmenu('refresh', true);
			//$("#voice").html(optionList).selectmenu('refresh', true);
		}		
		
		// document ready
        $(document).ready(function(e) {
			console.log("documentreadyfunction");
            $('#engine-selector input').change(prepareTTSConfigFields);
            $('#t2slang').change(populateVoice);

			//$('#t2slang').selectmenu('refresh', true);
			//$('#voice').selectmenu('refresh', true);
			
            // various validations
            initial_lang_voice_load();
			checkboxes();
			validateSB();
			validateTVMon();
			getsbconfig();

		
			// validate Volume entries per player
            var iteration = document.getElementById('countplayers').value;
            iteration = parseInt(iteration)
            iteration += 1;
            for (i = 1; i < iteration; ++i) {
                validate_enable('#t2svol' + i + '');
                validate_enable('#sonosvol' + i + '');
                validate_enable('#maxvol' + i + '');
                validate_chk_object(['#t2svol' + i + '', '#sonosvol' + i + '', '#maxvol' + i + '']);
            }
            // Function to control saving, main_form is submitted    
            $("form#main_form").submit(function(e) {
				console.log("submit");
				
				var selectlang = document.getElementById('t2slang').value;
				var selectvoice = document.getElementById('voice').value;
				console.log("selectlang: " + selectlang);
				console.log("selectvoice: " + selectvoice);
				
				var apidata = document.getElementById('apikey').value;
                if (document.getElementById('tts_polly').checked == true) {
					console.log("Polly checked");
					var seckeydata = document.getElementById('seckey').value;
					if (apidata.length != 20)    {
						dialog('<TMPL_VAR ERRORS.ERR_APIKEY20>', 'OK', 'error', 'Polly');
						return false;
                        e.preventDefault();
					}
					if (seckeydata.length != 40)    {
						dialog('<TMPL_VAR ERRORS.ERR_SECRETKEY>', 'OK', 'error', 'Polly');
						return false;
                        e.preventDefault();
					}
                    if (selectlang == null) {
 						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Polly');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
                    if (selectvoice == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Polly');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#voice").focus();
						return false;
                        e.preventDefault();
                    }
                } else if (document.getElementById('tts_mac_osx').checked == true) {
					conole.log("OSX checked");
                    if (selectlang == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Mac OSX');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
                } else if (document.getElementById('tts_voicerss').checked == true) {
					console.log("VoiceRSS checked");
					if (apidata.length != 32)    {
						dialog('<TMPL_VAR ERRORS.ERR_APIKEY32>', 'OK', 'error', 'Voice RSS');
						return false;
                        e.preventDefault();
					}
                    if (selectlang == null) {
 						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Voice RSS');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
				} else if (document.getElementById('tts_google_cloud').checked == true) {
					console.log("Google Cloud checked");
					if (apidata.length != 39)    {
						dialog('<TMPL_VAR ERRORS.ERR_APIKEY39>', 'OK', 'error', 'Google Cloud');
						return false;
                        e.preventDefault();
					}
                    if (selectlang == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Google Cloud');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
					if (selectvoice == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Google Cloud');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#voice").focus();
						return false;
                        e.preventDefault();
                    }
				} else if (document.getElementById('tts_elevenlabs').checked == true) {
					console.log("Elevenlabs checked");
					if (apidata.length != 32)    {
						dialog('<TMPL_VAR ERRORS.ERR_APIKEY32>', 'OK', 'error', 'ElevenLabs');
						return false;
                        e.preventDefault();
					}
                    if (selectlang == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'ElevenLabs');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
					if (selectvoice == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'ElevenLabs');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#voice").focus();
						return false;
                        e.preventDefault();
                    }
                } else if (document.getElementById('tts_pico').checked == true) {
					console.log("Pico checked");
                    if (selectlang == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Pico');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }

                //} else if (document.main_form.tts_respvoice.checked == true) {
				} else if (document.getElementById('tts_respvoice').checked == true) {
					console.log("RespVoice checked");
					console.log(selectlang);
                    if (selectlang == null) {
						//console.log("TEST");
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Responsive Voice');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
                } else if (document.getElementById('tts_google').checked == true) {
					console.log("Google checked");
                    if (selectlang == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Google');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
				} else if (document.getElementById('tts_azure').checked == true) {
					console.log("Azure checked");
					if (apidata.length != 32)    {
						dialog('<TMPL_VAR ERRORS.ERR_APIKEY32>', 'OK', 'error', 'Azure');
						return false;
                        e.preventDefault();
					}
                    if (selectlang == null) {
						dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'Azure');
                        $('html, body').animate({
                            scrollTop: $("#info").offset().top
                        }, 1000);
                        $("#t2slang").focus();
						return false;
                        e.preventDefault();
                    }
                } else {
					dialog('<TMPL_VAR T2S.VALIDATE_T2S_LANG>', 'OK', 'error', 'T2S Engine');
                    $('html, body').animate({
                        scrollTop: $("#info").offset().top
                    }, 1000);
                    $("#tts_voicerss").focus();
					console.log("No T2S Engine");
					return false;
					e.preventDefault();
				}
                $("#langiso").textinput("refresh");
				$("#info").trigger('create');
			
				// Save checkbox values
				var iteration = document.getElementById('countplayers').value;
				iteration = parseInt(iteration)
				iteration += 1;
				
				// loop through players
				for (i = 1; i < iteration; ++i) {
					if (document.getElementById('mainchk' + i).checked == true) {
						document.getElementById('mainchk' + i).value = "on";
						$('input:checkbox').checkboxradio('refresh');
					} else {
						document.getElementById('mainchk' + i).value = "off";
						$('input:checkbox').checkboxradio('refresh');
					}
				}
				
				// validate if at least one checkbox is checked
				var checkBoxes = document.getElementsByClassName('chk-checked');
				var isChecked = false;
				for (var i = 0; i < checkBoxes.length; i++) {
					if ( checkBoxes[i].checked ) {
						isChecked = true;
					};
				};
				if (!isChecked) {
					$('html, body').animate({
                        scrollTop: $("#mainchk1").offset().top
                    }, 1000);
					dialog('<TMPL_VAR ERRORS.ERR_CHECKBOX>', 'OK', 'error', 'T2S Emergency');
					return false;
				} 

				
				// validate jingle file selection
                var selectjingle = document.getElementById("file_gong").value;
                var selectt2s = $("input[name=t2s_engine]:checked").val();
				//console.log(selectjingle);
				//console.log(selectt2s);
                if ((selectjingle == '') && (selectt2s !== "")) {
                    $('html, body').animate({
                        scrollTop: $("#info").offset().top
                    }, 1000);
					dialog('<TMPL_VAR T2S.VALIDATE_JINGLE>', 'SELECT', 'error', 'T2S Jingle');
                    $("#file_gong").focus();
					e.preventDefault();
                }
				
				// validate UDP Port entered if UDP selected
				console.log("validate UDP");
				var cat = document.getElementById('sendlox').value;
				var mqtt = document.getElementById('sendloxMQTT').value;
				var udp = document.getElementById('udpport').value;
				$('#udpport').removeClass('ui-disabled');
				if (cat == "true" && mqtt == "false") {
					if (udp.length < 4) {
						$('html, body').animate({
							scrollTop: $("#udpport").offset().top
						}, 1000);
						$("#udpport").focus();
						dialog('<TMPL_VAR ERRORS.ERR_UDP_MISSING>', 'OK', 'error', 'UPD Port');
						//return false;
						e.preventDefault();
						
					}
				}
				$("#sendlox").flipswitch("refresh");
				// show Save message 
				timeout('<TMPL_VAR SAVE.SAVE_MESSAGE>', 'OK', 'info', '<TMPL_VAR SAVE.SAVE_ALL_OK>', '3500');
            });
        });
    </script>
</TMPL_IF>


<TMPL_IF VOLUME>
<!-- form 'FORM' VOLUME -->
<form method="post" data-ajax="false" accept-charset="utf-8" name="main_form" id="main_form" action="./index.cgi?do=volume">
        <input type="hidden" name="saveformdata3" value="1">
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/table.css"/>
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.min.css"/>
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.css"/>
		<script src="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.min.js"></script>
		<script src="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.js"></script>
		
        <div class="form-group">
		<tbody>
            <table class="formtable-container" id="vol" border="0" width="80%" cellpadding="10">
                <tr>
	                <td valign="left" style="height: 33px; width: 15%; text-align: left;">
                    <h2 class="auto-style3" style="width: 100%"></h2>
                    <td style="height: 33px; text-align: center; width: 850px;">
                        <img class='ico_sonos' src='/plugins/<TMPL_VAR PLUGINDIR>/images/sonos_logo.png' border='0' width='186' height='125' align="absmiddle">
					</th>
				</tr>
				
				<tr>
				<td valign="left" style="height: 33px; width: 25%; text-align: left;"></td>	
					<td valign="left">
						<table class='formtable' id='formtable' style='width:800px; background: rgba(192,192,192, 0.2); border-radius: 20px; border: 1px solid #7e7e7e; padding: 0px'>
							<td valign="left">
							<button onclick="create_new_profile()" type="button" class="btn btn-primary" style="width:180px; align:right" id="btnscan" data-icon="plus" data-role="button" data-mini="true">New Volume Profile</button>
								&nbsp;&nbsp;V = Volume, T = Treble, B = Bass, L = Loudness, SR = Surround, SW = Subwoofer, SWL = Subwooferlevel
								<!--&nbsp;&nbsp;Volume = (0 to 100)  Treble, Bass = (-6 to 6)  Subwooferlevel = (-15 to 15)-->
									<TMPL_VAR ROWSVOLPLAYER>
							</td>
						</table>
					</td>
				</tr>
			</table>
		</tbody>
		</div>
		
        <p>
            <center>
                <button type="submit" form="main_form" id="btnsubmit" data-role="button" data-inline="true" data-mini="true" data-icon="check"><TMPL_VAR SAVE.SAVE_BUTTON></button>
            </center>
        </p>
			
		<script>
					
			
			
			$(document).on('pageinit', function() {
				//getvolprofiles();
				//$('#main_form').trigger('create');
			});
			
			
								
			
			// add values to Profile and set all flipswitch
			function getvolprofiles()   {
				let countdata = 0;
				var data;
				
				$.ajax({
						url: 'index.cgi',
						type: 'post',
						data: { action: 'profiles'},
						dataType: 'json',
				})
					
				.fail(function (jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.done(function(data, textStatus, jqXHR) {
							//let countdata = $.map(data, function(n, i) { return i; }).length;
							//console.log(data);
							$.each(data, function(i, outerArray) {
								countdata++;
								$('#profile' + countdata).val(data[parseInt(countdata) - 1].Name);
								unsorted = outerArray.Player
								const sorted = Object.keys(unsorted).sort().reduce(
									(obj, key) => { 
											obj[key] = unsorted[key]; 
											return obj;
											}, 
									{}
								);
								var iteration = 0;
								iteration = parseInt(iteration)
								$.each(sorted, function(j, innerArray) {
									iteration++;
									//console.log(j);
									//console.log($('#vol_' + iteration + '_' + countdata));
									//$('#vol_' + iteration + '_' + countdata).val(innerArray[0].Volume);
									//$('#treble_' + iteration + '_' + countdata).val(innerArray[0].Treble);
									//$('#bass_' + iteration + '_' + countdata).val(innerArray[0].Bass);
									if (innerArray[0].Loudness == 'true') {
										$('#loudness_' + iteration + '_' + countdata).val("true").flipswitch("refresh");
									} else {
										$('#loudness_' + iteration + '_' + countdata).val("false").flipswitch("refresh");
									}
									if (innerArray[0].Surround == 'na') {
										$('#surround_' + iteration + '_' + countdata).flipswitch("disable");
										$('#surround_' + iteration + '_' + countdata).val("false").flipswitch("refresh");
									} else if (innerArray[0].Surround == 'true') {
										$('#surround_' + iteration + '_' + countdata).val("true").flipswitch("refresh");
									} else {
										$('#surround_' + iteration + '_' + countdata).val("false").flipswitch("refresh");
										$('#surround_' + iteration + '_' + countdata).val("false").flipswitch("refresh");
									}
									if (innerArray[0].Subwoofer == 'na') {
										$('#subwoofer_' + iteration + '_' + countdata).flipswitch("disable");
										$('#sbass_' + iteration + '_' + countdata).attr("disabled", "disabled").css("background", "rgba(192,192,192, 0.2)").textinput("refresh");
										$('#subwoofer_' + iteration + '_' + countdata).val("false").flipswitch("refresh");
									} else if (innerArray[0].Subwoofer == 'true') {
										$('#subwoofer_' + iteration + '_' + countdata).val("true").flipswitch("refresh");
									} else {
										$('#subwoofer_' + iteration + '_' + countdata).val("false").flipswitch("refresh");
									}
									//$('#sbass_' + iteration + '_' + countdata).val(innerArray[0].Subwoofer_level);
								})
							})
				})
				.always(function(data) {
					$('#main_table').trigger('create').trigger('refresh');
					console.log( "Action get Volume Profiles executed", data );
				})
				
			};
			
		// add dynamically new profile	
		function create_new_profile()   {
			
			let count = 0;
			last_id = parseInt(document.getElementById('last_id').value);
			new_id = last_id + 1;
			
			var iteration = 0;
            iteration = parseInt(iteration)
			var trHTML = '';
			
			$.ajax({
					url: 'index.cgi',
					type: 'post',
					data: { action: 'soundbars'},
					dataType: 'json',
					async: false,
						success: function(data, textStatus, jqXHR)   {
							//console.log(new_id);
							trHTML += "<div class=" + new_id +">";
							trHTML += "<table class='tables' style='width:100%' id='tblvol_prof" + new_id +"' name='tblvol_prof" + new_id +"'>\n";
							trHTML += "<th align='left' style='height: 25px; width:150px'>&nbsp;Profile #" + new_id +"</th>\n";
							trHTML += "<th align='middle' colspan='6'><div style='width: 180px; align: left'>\n";
							trHTML += "<input class='textfield' type='text' style='align: middle; width: 100%' id='profile" + new_id +"' name='profile" + new_id +"' value='' placeholder='Volume Profile Name'/>\n";
							trHTML += "<td valign='left'>";
							trHTML += "<img onclick='NewSonosData()' title='Load current values from Sonos devices' value='" + new_id +"' id='btnload" + new_id +"' name='btnload" + new_id +"' src='/plugins/<TMPL_VAR PLUGINDIR>/images/musik-note.png' border='0' width='28' height='28'>\n";
							trHTML += "<img title='Clone values from last Profile' onclick='cloneprofile()' value='new_id' id='btnclone" + new_id +"' name='btnclone" + new_id +"' class='ico_clone' src='/plugins/<TMPL_VAR PLUGINDIR>/images/clone.svg' border='0' width='33' height='33'></td>\n";
							trHTML += "</th><tr><th style='background-color: #6dac20;' align='left'>&nbsp;Rooms</th><div class='form-group col-7'>\n";
							trHTML += "<th class='form-control' style='background-color: #6dac20; align: center'>V</th>\n";
							trHTML += "<th class='form-control' style='background-color: #6dac20; align: center'>T</th>\n";
							trHTML += "<th class='form-control' style='background-color: #6dac20; align: center'>B</th>\n";
							trHTML += "<th class='form-control' style='background-color: #6dac20; align: center'>L</th>\n";
							trHTML += "<th class='form-control' style='background-color: #6dac20; align: center'>SR</th>\n";
							trHTML += "<th class='form-control' style='background-color: #6dac20; align: center'>SW</th>\n";
							trHTML += "<th class='form-control' style='background-color: #6dac20; align: center'>SWL</th>\n";
							trHTML += "</div></tr>";
							// sort table
							const sorted = Object.keys(data).sort().reduce(
								(obj, key) => { 
									obj[key] = data[key];;											
									return obj;
									}, 
								{}
							);
							$.each(sorted, function(j, value) {
								iteration++;
								//console.log(j);		
								//console.log(value);										
								trHTML += "<tr>";
								trHTML += "<td style='height: 25px; width: 160px;'><input type='text' id='zone_"+ iteration + "_" + new_id +"' name='zone_"+ iteration + "_" + new_id +"' readonly='true' value='" + j +"' style='width: 100%; background-color: #e6e6e6;'></td>";	
								trHTML += "<td style='width: 45px; height: 15px;'><input type='text' id='vol_"+ iteration + "_" + new_id +"' name='vol_"+ iteration + "_" + new_id +"' size='100' data-validation-rule='special:number-min-max-value:0:100' data-validation-error-msg='<TMPL_VAR T2S.ERROR_VOLUME_PLAYER>' value=''></td>";
								trHTML += "<td style='width: 45px; height: 15px;'><input type='text' id='treble_"+ iteration + "_" + new_id +"' name='treble_"+ iteration + "_" + new_id +"' size='100' data-validation-rule='special:number-min-max-value:-10:10' data-validation-error-msg='<TMPL_VAR VOLUME_PROFILES.ERROR_TREBLE_BASS_PLAYER>' value=''></td>\n";
								trHTML += "<td style='width: 45px; height: 15px;'><input type='text' id='bass_"+ iteration + "_" + new_id +"' name='bass_"+ iteration + "_" + new_id +"' size='100' data-validation-rule='special:number-min-max-value:-10:10' data-validation-error-msg='<TMPL_VAR VOLUME_PROFILES.ERROR_TREBLE_BASS_PLAYER>' value=''></td>\n";
								trHTML += "<td style='height: 10px; width: 5px; align: middle'>";
								trHTML += "<fieldset><select id='loudness_"+ iteration + "_" + new_id +"' name='loudness_"+ iteration + "_" + new_id +"' data-role='flipswitch' style='width: 5%'>\n";
								trHTML += "<option value='false'><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option><option value='true'><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>";
								trHTML += "</select></fieldset></td>\n";
								trHTML += "<td style='height: 10px; width: 25px; align: middle'>";
								if (value[10] == 'NOSUR') {
									trHTML += "<fieldset><select disabled id='surround_"+ iteration + "_" + new_id +"' name='surround_"+ iteration + "_" + new_id +"' data-role='flipswitch' style='width: 5%'>\n";
								} else {
									trHTML += "<fieldset><select id='surround_"+ iteration + "_" + new_id +"' name='surround_"+ iteration + "_" + new_id +"' data-role='flipswitch' style='width: 5%'>\n";
								}
								trHTML += "<option value='false'><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option><option value='true'><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>";
								trHTML += "</select></fieldset></td>\n";
								trHTML += "<td style='height: 10px; width: 25px; align: middle'>";
								if (value[8] == 'NOSUB') {
									trHTML += "<fieldset><select disabled id='subwoofer_"+ iteration + "_" + new_id +"' name='subwoofer_"+ iteration + "_" + new_id +"' data-role='flipswitch' style='width: 5%'>\n";
								} else {
									trHTML += "<fieldset><select id='subwoofer_"+ iteration + "_" + new_id +"' name='subwoofer_"+ iteration + "_" + new_id +"' data-role='flipswitch' style='width: 5%'>\n";
								}
								trHTML += "<option value='false'><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option><option value='true'><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>";
								trHTML += "</select></fieldset></td>\n";
								if (value[8] == 'NOSUB') {
									trHTML += "<td style='width: 55px; height: 15px;'><input disabled type='text' id='sbass_"+ iteration + "_" + new_id +"' name='sbass_"+ iteration + "_" + new_id +"' size='100' value=''></td>\n";
								} else {
									trHTML += "<td style='width: 55px; height: 15px;'><input type='text' id='sbass_"+ iteration + "_" + new_id +"' name='sbass_"+ iteration + "_" + new_id +"' size='100' data-validation-rule='special:number-min-max-value:-15:15' data-validation-error-msg='<TMPL_VAR VOLUME_PROFILES.ERROR_SUB_LEVEL_PLAYER>' value=''></td>\n";
								}
								trHTML += "</tr>";
							})
							trHTML += "</table></div>";
							
							$('#btnscan').hide();
							$('.ico_delete').hide();
							$('#new_id').val(new_id);
							$('#formtable').append(trHTML);
							$('#tblvol_prof' + new_id +'').trigger('create');
							$('#main_table').trigger('create');
							$("#btnsubmit").focus();
							$("#profile" + new_id +"").focus();							
						}
					})
					
				.fail(function (jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.always(function(data) {
					console.log( "Action New Volume Profile executed", data );
				})
			};
		
			// clone data from last saved profile
			function cloneprofile()   {
				var data;
				
				var last_id = parseInt(document.getElementById('last_id').value);
				var new_id = last_id + 1;
				//console.log(last_id);
				$.ajax({
						url: 'index.cgi',
						type: 'post',
						data: { action: 'profiles'},
						dataType: 'json',
						async: false,
				})
					
				.fail(function (jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.done(function(data, textStatus, jqXHR) {
							$.each(data, function(i, outerArray) {
								unsorted = outerArray.Player
								const sorted = Object.keys(unsorted).sort().reduce(
									(obj, key) => { 
											obj[key] = unsorted[key]; 
											return obj;
											}, 
									{}
								);
								var iteration = 0;
								iteration = parseInt(iteration)
								$.each(sorted, function(j, innerArray) {
									iteration++;
									//console.log(j);
									//console.log(innerArray);
									$('#vol_' + iteration + '_' + new_id).val(innerArray[0].Volume);
									$('#treble_' + iteration + '_' + new_id).val(innerArray[0].Treble);
									$('#bass_' + iteration + '_' + new_id).val(innerArray[0].Bass);
									if (innerArray[0].Loudness == 'true') {
										$('#loudness_' + iteration + '_' + new_id).val("true").flipswitch("refresh");
									} else {
										$('#loudness_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									}
									if (innerArray[0].Surround == 'na') {
										$('#surround_' + iteration + '_' + new_id).flipswitch("disable");
										$('#surround_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									} else if (innerArray[0].Surround == 'true') {
										$('#surround_' + iteration + '_' + new_id).val("true").flipswitch("refresh");
									} else {
										$('#surround_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									}
									if (innerArray[0].Subwoofer == 'na') {
										$('#subwoofer_' + iteration + '_' + new_id).flipswitch("disable");
										$('#sbass_' + iteration + '_' + new_id).attr("disabled", "disabled").css("background", "rgba(192,192,192, 0.2)").textinput("refresh");
										$('#subwoofer_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									} else if (innerArray[0].Subwoofer == 'true') {
										$('#subwoofer_' + iteration + '_' + new_id).val("true").flipswitch("refresh");
									} else {
										$('#subwoofer_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									}
									$('#sbass_' + iteration + '_' + new_id).val(innerArray[0].Subwoofer_level);
								})
							})
				})
				.always(function(data) {
					console.log( "Action Clone Profile executed", data );
				})
				
			};
		
			// Sub Fucntion for new added Profile
			function NewSonosData()   {
				var last_id = parseInt(document.getElementById('last_id').value);
				var load = last_id + 1;
				obtainSonosData(load);
			}
			
			// get actual data from all Player
			function obtainSonosData(load)   {
				var arrkey = parseInt(load) - 1;
				var new_id = load;

			    $.ajax({
					url: '/plugins/<TMPL_VAR PLUGINDIR>/bin/vol_prof_ini.php',
					type: 'post',
					dataType: "json",
					data: { 'new_id': 'true'}
				})	
				.fail(function (jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.done(function(data, textStatus, jqXHR) {
							//console.log(data);
							$.each(data, function(i, outerArray) {
								//console.log(outerArray);
								$('#profile' + new_id).val("");
								unsorted = outerArray.Player
								const sorted = Object.keys(unsorted).sort().reduce(
									(obj, key) => { 
											obj[key] = unsorted[key]; 
											return obj;
											}, 
									{}
								);
								var iteration = 0;
								iteration = parseInt(iteration)
								$.each(sorted, function(j, innerArray) {
									iteration++;
									//console.log(sorted);
									//console.log(innerArray);
									$('#vol_' + iteration + '_' + new_id).val(innerArray[0].Volume);
									$('#treble_' + iteration + '_' + new_id).val(innerArray[0].Treble);
									$('#bass_' + iteration + '_' + new_id).val(innerArray[0].Bass);
									if (innerArray[0].Loudness == 'true') {
										$('#loudness_' + iteration + '_' + new_id).val("true").flipswitch("refresh");
									} else {
										$('#loudness_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									}
									if (innerArray[0].Surround == 'na') {
										$('#surround_' + iteration + '_' + new_id).flipswitch("disable");
										$('#surround_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									} else if (innerArray[0].Surround == 'true') {
										$('#surround_' + iteration + '_' + new_id).val("true").flipswitch("refresh");
									} else {
										$('#surround_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									}
									if (innerArray[0].Subwoofer == 'na') {
										$('#subwoofer_' + iteration + '_' + new_id).flipswitch("disable");
										$('#sbass_' + iteration + '_' + new_id).attr("disabled", "disabled").css("background", "rgba(192,192,192, 0.2)").textinput("refresh");
										$('#subwoofer_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									} else if (innerArray[0].Subwoofer == 'true') {
										$('#subwoofer_' + iteration + '_' + new_id).val("true").flipswitch("refresh");
									} else {
										$('#subwoofer_' + iteration + '_' + new_id).val("false").flipswitch("refresh");
									}
									$('#sbass_' + iteration + '_' + new_id).val(innerArray[0].Subwoofer_level);
								})
							})
				})
				.always(function(data) {
					console.log( "Action load Sonos Data executed", data );
				})
				
			};
			
			
		// iniciate deleting profile
		$(".ico-delete").on("click", function() {
			$('#delprofil').val(0);
			var del = ($(this).attr('value'));
			deletedialog('<TMPL_VAR VOLUME_PROFILES.DIALOG_DELETE>', '<TMPL_VAR VOLUME_PROFILES.DIALOG_BUTTON_DELETE>', 'question', 'Volume Profile', del);
		});
		
		// iniciate loading actual data
		$(".ico-load").on("click", function() {
			var load = ($(this).attr('value'));
			obtainSonosData(load);
		});
		
		// pop-up Dailog Box for Profil deletion
		function deletedialog(text, ButtonText, Icon='', Title, del)    {
			// https://silverboxjs.ir/documentation/?v=latest
			silverBox({
				alertIcon: Icon,
				text: text,
				centerContent: true,
				title: {
						text: Title
						},
				confirmButton: {
								bgColor: "#6dac20",
								border: "10px",
								borderColor: "#6dac20",
								textColor: "#fff",
								text: ButtonText,
								closeOnClick: true,
								iconStart: "/plugins/<TMPL_VAR PLUGINDIR>/images/recycle-bin.png",
								onClick: () => { deleteProfile(del)	},
								},
				cancelButton: {
								text: "<TMPL_VAR SAVE.CANCEL_BUTTON>",
								iconStart: "/plugins/<TMPL_VAR PLUGINDIR>/web/images/cancel.svg",
								onClick: () => {return;
												},
								},
				});
		}
			
			
		// pop-up Message during saving	
		function message()   {
			console.log("Save data");
			timeout('<TMPL_VAR SAVE.SAVE_MESSAGE>', 'OK', 'info', '<TMPL_VAR SAVE.SAVE_ALL_OK>', '3000');
		}
		
		// pop-up Timeout Dailog Box
		function timeout(text, ButtonText, Icon='', Title, timeout)    {
			// https://silverboxjs.ir/documentation/?v=latest
			silverBox({
				timer: timeout,
				//alertIcon: Icon,
				customIcon: "/plugins/<TMPL_VAR PLUGINDIR>/web/images/info.svg",
				text: text,
				centerContent: true,
				title: {
						text: Title
						},
				});
		}
			
		// delete Profile	
		function deleteProfile(del)   {
			$('#delprofil').val(del);
			$('#main_form').trigger('submit').trigger('create');
		}
		
		
		// validate input fields on Profiles
		function validateProfiles()  {

			var iteration = document.getElementById('countplayers').value;
			var iterate_id = document.getElementById('new_id').value;
			iteration = parseInt(iteration)
			iterate_id = parseInt(iterate_id)
			iteration += 1;
			iterate_id += 1;
			for (i = 1; i < iteration; ++i) {
				for (e = 1; e < iterate_id; ++e) {
					volume = $('#vol_' + i + '_' + e + '').val();
					treble = $('#treble_' + i + '_' + e + '').val();
					bass = $('#bass_' + i + '_' + e + '').val();
					sbass = $('#sbass_' + i + '_' + e + '').val();
					if (volume.length != 0)  {
						validate_enable('#vol_' + i + '_' + e);
						validate_chk_object(['#vol_' + i + '_' + e]);
					}
					if (treble.length != 0)  {
						validate_enable('#treble_' + i + '_' + e);
						validate_chk_object(['#treble_' + i + '_' + e]);
					}
					if (bass.length != 0)  {
						validate_enable('#bass_' + i + '_' + e);
						validate_chk_object(['#bass_' + i + '_' + e]);
					}
					if (sbass.length != 0)  {
						validate_enable('#sbass_' + i + '_' + e);
						validate_chk_object(['#sbass_' + i + '_' + e]);
					}
				}
			}
		}

		function ProfilNameDialog(text, ButtonText, Icon='', Title)    {		
			// https://silverboxjs.ir/documentation/?v=latest
			silverBox({
				alertIcon: 'warning',
				text: text,
				centerContent: true,
				title: {
						text: Title
						},
				confirmButton: {
								bgColor: "#6dac20",
								border: "10px",
								borderColor: "#6dac20",
								textColor: "#fff",
								text: ButtonText,
								closeOnClick: true
								}
				});
		}
			
		
        $(document).ready(function(e) {
			getvolprofiles();
			validateProfiles();	

			$("form#main_form").submit(function(e) {
				console.log("Submit");
				// validate if Profile Name has been entered
				var iterate = document.getElementById('new_id').value;
				iterate = parseInt(iterate)
				iterate += 1;
				for (i = 1; i < iterate; ++i) {
					if($('#profile' + i + '').val() == "")   {
						$('#profile' + i + '').focus();	
						ProfilNameDialog("<TMPL_VAR VOLUME_PROFILES.DIALOG_PROFILE_NAME>", "OK", Icon='', "Name");	
						return false;
					}
				};
				var validationFailed = false;
				validateProfiles();	
				if (validationFailed) {
					e.preventDefault();
					return false;
				} else {
					message();
				}
				$('#main_table').trigger('create').trigger('refresh');;
			});
		});
		

		</script>
</form>	
		
</TMPL_IF>


<TMPL_IF LOGFILES>
    <!-- form 'LOGFILES' START -->
    <TMPL_VAR LOGLIST_HTML>
    <!-- form 'LOGFILES' END -->
</TMPL_IF LOGFILES>


<TMPL_IF DETAILS>
    <!-- form 'FORM' DETAILS -->
    <form method="post" data-ajax="false" accept-charset="utf-8" name="main_form" id="main_form" action="./index.cgi?do=details">
        <input type="hidden" name="saveformdata2" value="1">
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.min.css"/>
		<link rel="stylesheet" href="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.css"/>
		<script src="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.min.js"></script>
		<script src="/plugins/<TMPL_VAR PLUGINDIR>/web/silverBox.js"></script>
        <div class="form-group">
            <table class="formtable" border="0" width="90%" cellpadding="10">
                <tr>
                    <td valign="middle" style="height: 33px; width: 25%; text-align: center;">
                        <h2 class="auto-style3" style="width: 100%">
                            <TMPL_VAR ZONES.SONOS_OPTIONS>
                        </h2>
                        <td style="height: 33px; text-align: center; width: 800px;">
                            <img class='ico_sonos' src='/plugins/<TMPL_VAR PLUGINDIR>/images/sonos_logo.png' border='0' width='186' height='125' align="absmiddle">
                        </td>
                </tr>

                <tr>
                    <td style="height: 60px; width: 15%;">
                        <!--<a id="lcheckonline" <TMPL_VAR T2S.ONLINECHECK_LINK> target="_blank"><TMPL_VAR T2S.ONLINECHECK></a>-->
                        <label id="lcheckonline"><TMPL_VAR T2S.ONLINECHECK></label>
                    </td>
                    <td style="height: 60px; width: 800px;">
                        <table border=0 width="100%">
                            <tr>
                                <td style="width: 5%">
                                    <fieldset>
                                        <!--<select onchange="cronjob()" id="checkonline" name="checkonline" data-role="flipswitch" style="width: 104px">-->
                                    <select id="checkt2s" name="checkt2s" data-role="flipswitch" style="width: 5%">
										<option value="false"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
										<option selected="selected" value="true"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
									</select>
                                    </fieldset>
                                    <script>
                                        $('#checkt2s').val('<TMPL_VAR SYSTEM.checkt2s>')
                                    </script>
                                </td>

								<td style="width: 40%; text-align: center;">
                                    <label align="right" id="lfunc_list"><TMPL_VAR T2S_DETAILS.LABEL_ZAPZONE></label>
								</td>
                                <td style="width: 30%">
                                    <!--<table class="cronjob" border=0 style="width: 91%">-->
                                        	<select id="func_list" name="func_list" data-mini="true" data-native-menu="true">
												<option selected="selected" disabled value="" >*** Select Function ***</option>
												<option value="nextradio" >Nextradio</option>
												<option value="trackfavorites" >Track Favorites</option>
												<option value="playlistfavorites" >Playlist Favorites</option>
												<option value="radiofavorites" >Radio Favorites</option>
												<option value="tuneinfavorites" >TuneIn Radio</option>
											</select>
                                    <!--</table>-->
                                </td>
									<td style="width: 20%; height: 60px;">
                                        <label align="right" id="lcron"><TMPL_VAR T2S_DETAILS.LABEL_ZAPZONE_RESET></label>
                                </td>
                                <td style="width: 29%">
                                    <select id="cron" name="cron" data-mini="true" data-native-menu="true" style="width: 29%">
										<option value="1">1 Min</option>
										<option value="3">3 Min</option>
										<option value="5">5 Min</option>
										<option value="10">10 Min</option>
										<option value="30">30 Min</option>
									</select>
                                    <script>
                                        $('#cron').val('<TMPL_VAR VARIOUS.cron>');
                                    </script>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <!--<td style="height: 30px; width: 201px;"></td>
			<td style="height: 30px; width: 24px;">
				<font size="-1">
					<div id="testurl"></div>
				</font>
			</td>-->
                </tr>
                <tr>
                    <td style="height: 60px; width: 25%;">
                        <label id="lvolume"><TMPL_VAR T2S_DETAILS.LABEL_T2S_VOLUME_CHANGE></label>
                    </td>
					
                    <td style="width: 20%">
                        <select id="volume" name="volume" data-mini="true" data-native-menu="true" style="width: 100%">
							<option value="3">3 %</option>
							<option value="5">5 %</option>
							<option value="7">7 %</option>
							<option value="10">10 %</option>
						</select>
                        <script>
                            $('#volume').val('<TMPL_VAR MP3.volumedown>');
                        </script>
					</td>
                   

                </tr>
                <td style="width: 27%">
                    <TMPL_VAR RADIO.LABEL_RADIO_ANNOUNCE>
                </td>
                <td style="width: 800px">
                    <fieldset style="width: 788px">
                        <select onchange="select()" id="announceradio" name="announceradio" data-role="flipswitch">
					<option value="0"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
					<option value="1"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
				</select>&nbsp;&nbsp;
                        <script>
                            $('#announceradio').val('<TMPL_VAR VARIOUS.announceradio>')
                        </script>
                        <span class="auto-style4"><TMPL_VAR RADIO.NOTE_RADIO_ANNOUNCE></span>
                    </fieldset>
                    <input id="maxzap" name="maxzap" type="hidden" class="textfield" value="<TMPL_VAR MAXZAP>">
                </td>
                <tr>
                    <td style="width: 27%">
                        <TMPL_VAR RADIO.LABEL_RADIO_ANNOUNCE_ALWAYS>
                    </td>
                    <td style="width: 800px">
                        <fieldset style="width: 788px">
                            <select onchange="select_always()" id="announceradio_always" name="announceradio_always" data-role="flipswitch">
						<option value="0"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
						<option value="1"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
					</select>&nbsp;&nbsp;
                            <script>
                                $('#announceradio_always').val('<TMPL_VAR VARIOUS.announceradio_always>')
                            </script>
                            <span class="auto-style4"><TMPL_VAR RADIO.NOTE_RADIO_ANNOUNCE_ALWAYS></span>
                        </fieldset>
                    </td>

                </tr>
                <tr class="radioannounce">
                    <td style="height: 60px; width: 25%;">
                        <label id="lcorrection"><TMPL_VAR T2S.LABEL_CORRECTION></label>
                    </td>
                    <td style="height: 60px; width: 800px;">
                        <input type="range" name="correction" id="correction" value="<TMPL_VAR TTS.correction>" min="0" max="20" step="2">
                    </td>
                    
                </tr>

                <tr class="t2sdet">
                    <td style="width: 25%; height: 40px;">
                        <label id="lrampto"><TMPL_VAR T2S_DETAILS.LABEL_RAMPTO></label>
                    </td>
                    <td style="width: 50%; height: 60px;">
                        <table border=0 width="100%">
                            <td style="width: 60%; height: 45px;">
                                <fieldset data-role="controlgroup" data-type="horizontal">
                                    <input type="radio" name="rampto" id="rmpsleep" value="sleep">
                                    <label for="rmpsleep">Sleep</label>
                                    <input type="radio" name="rampto" id="rmpalarm" value="alarm">
                                    <label for="rmpalarm">Alarm</label>
                                    <input type="radio" name="rampto" id="rmpauto" value="auto">
                                    <label for="rmpauto">Auto</label>
                                </fieldset>
                                <script>
                                    $("input[name=rampto]").val(['<TMPL_VAR TTS.rampto>']);
                                </script>
                            </td>
                            <td style="width: 40%; height: 45px">
                                <table border=0 align="left" style="width: 99%">
                                    <tr>
                                        <td style="height: 30px; width: 70%; text-align: center;">
                                            <label id="lrmpvol"><TMPL_VAR T2S_DETAILS.LABEL_RAMPTO_VOLUME></label>
                                        </td>
                                        <td style="text-align: right;">
                                            <input id="rmpvol" name="rmpvol" type="text" data-validation="number" class="textfield" value="<TMPL_VAR TTS.volrampto>" 
											data-validation-allowing="special:number-min-max-value:1:100" 
											data-validation-error-msg="<TMPL_VAR T2S_DETAILS.ERROR_RAMPTO>">
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </table>
                        
                </tr>

                <tr>
                    <td style="height: 60px; width: 25%;">
                        <label id="lphonemute"><TMPL_VAR T2S.LABEL_PHONEMUTE></label>
                    </td>
                    <td style="height: 60px; width: 800px;">
                        <input type="range" name="phonemute" id="phonemute" value="<TMPL_VAR VARIOUS.phonemute>" min="0" max="16" step="2">
                    </td>
                    
                    
                </tr>
				
				<tr>
                    <td style="height: 60px; width: 15%; text-align: left;">
                        <label id="lcheckonline"><TMPL_VAR ZONES.FOLLOW_LABEL></label>
                    </td>
                    <td style="height: 60px; width: 30%;">
                        <table border=0 width="65%">
                            <tr>
							<td style="width:15%; text-align: right;">
                                <label align="left" id="lfollow_host"><TMPL_VAR ZONES.FOLLOW_HOST_LABEL></label>
							</td>
                            <td style="width: 15%">
                                <select id="follow_host" name="follow_host" data-mini="true" data-native-menu="true">
									<option selected="selected" value="false" ><TMPL_VAR ZONES.FOLLOW_HOST_OPTION></option>
									<TMPL_VAR ROWSHOSTPLAYER>
								</select>
								<script>
								$('#follow_host').val('<TMPL_VAR VARIOUS.follow_host>');
								</script>	
                            </td>

								<td style="width: 11%; text-align: left;">
                                    <label align="right" id="lfollow_wait"><TMPL_VAR ZONES.FOLLOW_HOST_WAIT_LABEL></label>
								</td>
                                <td style="width: 15%">
                                        	<select id="follow_wait" name="follow_wait" data-mini="true" data-native-menu="true">
												<option selected="selected" value="false" ><TMPL_VAR ZONES.FOLLOW_HOST_WAIT_OPTION></option>
												<option value="0" ><TMPL_VAR ZONES.FOLLOW_HOST_WAIT_OPTION_TIME></option>
												<option value="30" >30 Sec.</option>
												<option value="60" >1 Min.</option>
												<option value="120" >2 Min.</option>
												<option value="180" >3 Min.</option>
												<option value="300" >5 Min.</option>
											</select>
										<script>
											$('#follow_wait').val('<TMPL_VAR VARIOUS.follow_wait>');
										</script>	
                                    <!--</table>-->
                                
                            </tr>
                        </table>
                    </td>
                </tr>
				
				<tr>
                    <td style="height: 60px; width: 15%; text-align: left;">
                        <label id="lswupdate"><TMPL_VAR ZONES.SONOS_LABEL_UPDATE_FIRMWARE></label>
                    </td>
                    <td style="height: 60px; width: 30%;">
                        <table border=0 width="80%">
                            <tr>
							<td style="width: 10%">
									<fieldset style="width: 100%">
										<select onchange="select_update()" id="hw_update" name="hw_update" data-role="flipswitch">
											<option value="false"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
											<option value="true"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
										</select>
										<script>
											$('#hw_update').val('<TMPL_VAR SYSTEM.hw_update>')
										</script>
									</fieldset>
								</td>
								<div class="update">
								<td class="update" style="width: 15%; height: 60px;">
                                    <label align="right" id="lstartupdate">Start:</label>
                                </td>
								<td class="update" style="width: 20%">
										<fieldset style="width:90%">
											<select id="hw_update_day" name="hw_update_day" data-mini="true" data-native-menu="true" style="width: 100%">
												  <option selected="selected" value="10"><TMPL_VAR TEMPLATE.UPDATE_DAILY></option>
												  <option disabled value="7"><TMPL_VAR TEMPLATE.UPDATE_WEEKLY></option>
												  <option value="1"><TMPL_VAR TEMPLATE.UPDATE_MONDAY></option>
												  <option value="2"><TMPL_VAR TEMPLATE.UPDATE_TUESDAY></option>
												  <option value="3"><TMPL_VAR TEMPLATE.UPDATE_WEDNESDAY></option>
												  <option value="4"><TMPL_VAR TEMPLATE.UPDATE_THURSDAY></option>
												  <option value="5"><TMPL_VAR TEMPLATE.UPDATE_FRIDAY></option>
												  <option value="6"><TMPL_VAR TEMPLATE.UPDATE_SATURDAY></option>
												  <option value="0"><TMPL_VAR TEMPLATE.UPDATE_SUNDAY></option>
											</select>
										</fieldset>
										<script>
											$('#hw_update_day').val('<TMPL_VAR SYSTEM.hw_update_day>');
										</script>
                               </td>
                                <td class="update" style="width: 20%">
										<fieldset style="width:90%">
											<select id="hw_update_time" name="hw_update_time" data-mini="true" data-native-menu="true" style="width: 100%">
												  <option value="0">0:00</option>
												  <option value="1">1:00</option>
												  <option value="2">2:00</option>
												  <option value="3">3:00</option>
												  <option value="4">4:00</option>
												  <option value="5">5:00</option>
												  <option value="6">6:00</option>
												  <option value="7">7:00</option>
												  <option value="8">8:00</option>
												  <option value="9">9:00</option>
												  <option value="10">10:00</option>
												  <option value="11">11:00</option>
												  <option value="12">12:00</option>
												  <option value="13">13:00</option>
												  <option value="14">14:00</option>
												  <option value="15">15:00</option>
												  <option value="16">16:00</option>
												  <option value="17">17:00</option>
												  <option value="18">18:00</option>
												  <option value="19">19:00</option>
												  <option value="20">20:00</option>
												  <option value="21">21:00</option>
												  <option selected="selected" value="22">22:00</option>
												  <option value="23">23:00</option>
											</select>
										</fieldset>
										<script>
											$('#hw_update_time').val('<TMPL_VAR SYSTEM.hw_update_time>');
										</script>
                               </td>
								
								<td class="update" style="width: 17%; text-align: left;">
                                    <label align="right" id="lupdatepower">Power On:</label>
								</td>
                                <td class="update" style="width: 5%">
                                    <fieldset style="width: 100%">
										<select id="hw_update_power" name="hw_update_power" data-role="flipswitch">
											<option value="false"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
											<option value="true"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
										</select>
									</fieldset>
									<script>
										$('#hw_update_power').val('<TMPL_VAR SYSTEM.hw_update_power>');
									</script>
                                </td>
								</div>
                            </tr>
                        </table>
                    </td>
                </tr>
				

                <tr>
                    <td style="width: 27%">
                        <TMPL_VAR T2S_DETAILS.LABEL_PHONESTOP>
                    </td>
                    <td style="height: 60px; width: 800px;">
                        <table border=0 width="100%">
                            <tr>
                                <td style="width: 10%">
									<fieldset style="width: 30%">
										<select id="phonestop" name="phonestop" data-role="flipswitch">
											<option value="0"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
											<option value="1"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
										</select>
										<script>
											$('#phonestop').val('<TMPL_VAR VARIOUS.phonestop>')
										</script>
									</fieldset>
								</td>
                                <td style="width: 23px; text-align: center;">
                                    &nbsp;</td>
                                <td>
                                    <table class="volmax" border=0 style="width: 91%">
                                        <tr>
                                            <td style="width: 50%; height: 60px;">
                                                <label align="right" id="lcron"><TMPL_VAR T2S_DETAILS.LABEL_MAX_VOLUME>&nbsp;&nbsp;&nbsp;</label>
                                            </td>
                                            <td style="width: 10%">
												<fieldset style="width: 30%">
													<select id="volmax" name="volmax" data-role="flipswitch">
														<option value="0"><TMPL_VAR T2S.LABEL_FLIPSWITCH_OFF></option>
														<option value="1"><TMPL_VAR T2S.LABEL_FLIPSWITCH_ON></option>
													</select>
													<script>
														$('#volmax').val('<TMPL_VAR VARIOUS.volmax>')
													</script>
												</fieldset>
											</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>

                <tr>
                    <td style="height: 60px; width: 25%;">
                        <label id="lwaiting"><TMPL_VAR T2S.LABEL_WAITING></label>
                    </td>
                    <td style="height: 60px; width: 800px;">
                        <input type="range" name="waiting" id="waiting" value="<TMPL_VAR MP3.waiting>" min="0" max="10" step="1">
                    </td>
					</tr>
					<!--<tr>
                    <!--Start *** HIDDEN Workaround Felder um 3 Felder zu escapen
                    <td style="height: 30px; width: 50px;">
                        <input id="wastecal" name="wastecal" type="hidden" class="textfield" value="<TMPL_VAR VARIOUS.CALDavMuell>">
                    </td>
                    <td style="height: 30px; width: 50px;">
                        <input id="cal" name="cal" type="hidden" class="textfield" value="<TMPL_VAR VARIOUS.CALDav2>">
                    </td>
                    <!--<td style="height: 30px; width: 50px;">
						<input id="town" name="town" type="text" class="textfield" value="<TMPL_VAR LOCATION.town>">
					</td>
                    <table id="divCheckbox" style="display:none">
                        <TMPL_VAR ROWSRADIO>
                    </table>
                    
                    <!--Ende *** HIDDEN Workaround Felder um 3 Felder zu escapen
                </tr>-->

            </table>
            <td></td>
            <p>
                <center>
                    <!--<a id="btncancel" data-role="button" data-inline="true" data-mini="true" data-icon="delete" href="/admin/index.cgi"><TMPL_VAR SAVE.CANCEL_BUTTON></a>-->
                    <button onclick="message()" type="submit" form="main_form" id="btnsubmit" data-role="button" data-inline="true" data-mini="true" data-icon="check"><TMPL_VAR SAVE.SAVE_BUTTON></button>
                </center>
            </p>

            <script>
                $(document).on('pageinit', function() {
                    select();
					select_update();
                    //select_always();
                    //cronjob();

                });

                function select() {
                    var rad = document.getElementById('announceradio').value;
                    var rad1 = document.getElementById('announceradio_always').value;
                    if (rad == true || rad1 == true) {
                        $('.radioannounce').show();
                    } else {
                        $('.radioannounce').hide();
                    }
                }

                function select_always() {
                    var rad1 = document.getElementById('announceradio_always').value;
                    if (rad1 == true) {
                        $('.radioannounce').show();
                    } else {
                        $('.radioannounce').hide();
                    }
                }
				
				function select_update() {
                    var up = document.getElementById('hw_update').value;
					//console.log(up);
                    if (up == 'true') {
                        $('.update').show();
                    } else {
                        $('.update').hide();
                    }
                }
				
								
				function message()   {
					console.log("Save");
					timeout('<TMPL_VAR SAVE.SAVE_MESSAGE>', 'OK', 'info', '<TMPL_VAR SAVE.SAVE_ALL_OK>', '3000');
				}
				
				// pop-up Timeout Dailog Box
				function timeout(text, ButtonText, Icon='', Title, timeout)    {
					// https://silverboxjs.ir/documentation/?v=latest
					silverBox({
						timer: timeout,
						//alertIcon: Icon,
						customIcon: "/plugins/<TMPL_VAR PLUGINDIR>/web/images/info.svg",
						text: text,
						centerContent: true,
						title: {
								text: Title
								},
						});
				}
				
				// pop-up Dailog Box
				function dialog(text, ButtonText, Icon='', Title)    {
					// https://silverboxjs.ir/documentation/?v=latest
					silverBox({
						alertIcon: Icon,
						text: text,
						centerContent: true,
						title: {
								text: Title
								},
						confirmButton: {
										bgColor: "#6dac20",
										border: "10px",
										borderColor: "#6dac20",
										textColor: "#fff",
										text: ButtonText,
										closeOnClick: true
										}
						});
				}
				
				// get Radio favorites
				$.ajax({
						url: 'index.cgi',
						type: 'post',
						data: { action: 'getradio'},
						dataType: 'json',
						async: false,
							success: function( response, textStatus, jqXHR )  {
							//$('#func_list').append('<option value="" disabled>** only for FOLLOW function***</option>');
								$.each(response, function(index, value) {
									result = value.split(',');
									$('#func_list').append('<option value="' + result[1] + '">Plugin Radio: ' + result[0] + '</option>');
								});
							}
						})
						.fail(function (jqXHR, textStatus, errorThrown) {
							console.log(errorThrown);
						})
						.always(function(response) {
							$('#func_list').val('<TMPL_VAR VARIOUS.selfunction>');
							console.log( "Action get Radio Favorites executed" );
						})
			
				</script>
        </div>
    </form>
</TMPL_IF>
